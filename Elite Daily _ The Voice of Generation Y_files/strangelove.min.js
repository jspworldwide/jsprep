$ = jQuery;

// Our functions
var site_nav = {

    section_dropdown: function() {
        dropDownOpen = false;
        $('.section-tab').on('click touchstart', function(e) {
            e.stopPropagation();
            e.preventDefault();
            if (dropDownOpen === true) {
                site_nav.section_close();
            } else {
                site_nav.section_open(e);
            }
            $(document).keyup(function(e) {
                if (e.keyCode == 27) {
                    site_nav.section_close();
                }
            });
        });

    },

    section_open: function (e){
        $('.drop-menu-arrow').fadeIn();
        if ($('.header-billboard').height() > 0 && !$('body').hasClass('home')) {
            var navAdHeight = $('.main-nav').height();
            $('.drop-down-menu').css({'top' : navAdHeight }).addClass('open-drop-menu');
        } else {
            $('.drop-down-menu').addClass('open-drop-menu');
        }
        $('.drop-menu-indicator').addClass('indicator-active');
        $('.nav-wrapper').removeClass('nav-shadow');
        dropDownOpen = true;
        //console.log(dropDownOpen);
        site_nav.section_click_off(e);

    },

    section_close: function (){
        $('.drop-menu-arrow').fadeOut();
        if ($('.header-billboard').height() > 0 && !$('body').hasClass('home')) {
            $('.drop-down-menu').css({'top': '-300px'}).removeClass('open-drop-menu');
        } else {
            $('.drop-down-menu').removeClass('open-drop-menu');
        }
        $('.drop-menu-indicator').removeClass('indicator-active');
        if (!$('.nav-wrapper').length > 0) {
            $('.nav-wrapper').addClass('nav-shadow');
        }
        dropDownOpen = false;
        //console.log(dropDownOpen);
        $('body').unbind();
    },

    section_click_off: function(e){
        $('body').bind('click touchstart', function(e){
            e.stopPropagation();
            if (!$(e.target).hasClass('open-drop-menu') && !$(e.target).parents('.drop-down-menu').hasClass('open-drop-menu') ){
                //console.log(e.target);
                site_nav.section_close();
            }
        });
    },

    user_profile_dropdown: function (){
        if (strangelove.get_window_width() > 768) {
            site_nav.profile_dropdown_visibility();
        }

        $(window).resize(function (){
            site_nav.profile_dropdown_visibility();
        });

        if (strangelove.is_current_page('single')){
            if (strangelove.get_window_width() > 768) {
                site_nav.profile_dropdown_visibility_related();
            }

            $(window).resize(function (){
                site_nav.profile_dropdown_visibility_related();
            });
        }
    },

    profile_dropdown_visibility: function (){
        $(document).on({
            mouseenter: function(){
                $('.article-nav, .related-nav').css({'display':'none'});
                $('.home-nav .dropmenu-user').css({'display':'block'});
                $('.home-nav .dropmenu-user .drop-menu-arrow').css({'display':'block'});
                $('.nav-wrapper').css({'overflow':'visible'});
            },
            mouseleave: function(){
                $('.nav-wrapper').css({'overflow':'hidden'});
                $('.home-nav .dropmenu-user .drop-menu-arrow').css({'display':'none'});
                $('.home-nav .dropmenu-user').css({'display':'none'});
                $('.article-nav, .related-nav').css({'display':'block'});
            }
        }, '.home-nav .sign-in-header');
    },

    profile_dropdown_visibility_related: function (){
        $(document).on({
            mouseenter: function(){
                // $('.article-nav, .home-nav').css({'display':'none'});
                $('.main-nav').css({'height':'60px'});
                $('.related-nav .dropmenu-user').css({'display':'block'});
                $('.related-nav .dropmenu-user .drop-menu-arrow').css({'display':'block'});
                $('.nav-wrapper').css({'overflow':'visible'});
            },
            mouseleave: function(){
                $('.main-nav').css({'height':'auto'});
                $('.nav-wrapper').css({'overflow':'hidden'});
                $('.related-nav .dropmenu-user .drop-menu-arrow').css({'display':'none'});
                $('.related-nav .dropmenu-user').css({'display':'none'});
                // $('.article-nav, .home-nav').css({'display':'block'});
            }
        }, '.related-nav .sign-in-header');
    },

    nav_search: function() {
        searchOpen = false;

        $('li.search-header, .sl-section-close').on('click touchstart', function (e){
            e.preventDefault();

            if (searchOpen === true) {
                site_nav.search_close();
            } else {
                site_nav.search_open();
            }

            $(document).keyup(function(e) {
                if (e.keyCode == 27) {
                    site_nav.search_close();
                }
            });

        });
    },

    search_open: function (){
        $('body').css('overflow', 'hidden');
        $('.sl-modal-screen').addClass('modal-open');
        $('.category-nav, .topic-nav').fadeOut(function (){
           $('.search-field, .sl-modal-screen, .sl-section-close').fadeIn();
            $('#nav-search-input').focus();
        });
        site_nav.search_result_offset();
        site_nav.type_delay();

        searchOpen = true;
    },

    search_close: function (){
        $('.sl-modal-screen, #search-result-list, .search-field, .sl-section-close').fadeOut('150', function() {
            $('.sl-modal-screen').fadeOut();
        });
        $('.category-nav, .topic-nav').delay('300').fadeIn();
        $('body').css('overflow', 'inherit');
        $('.sl-modal-screen.modal-open').removeClass('modal-open');
        searchOpen = false;
    },

    type_delay: function() {
        var options = {
            callback: function(value) {
                $('#search-result-list ul').html(' ');
                site_nav.es_results(value);
            },
            wait: 500,
            highlight: true,
            captureLength: 3
        }

        $("#nav-search-input").typeWatch(options);
    },

    es_results: function(searchVal) {
        var searchUrl = '/?elasticsearch=get_search_results&search=' + searchVal;
        $.getJSON(searchUrl, function(data) {
        	//console.log(data);
			site_nav.lock_modal_scroll();

            var search_posts = data.posts.sort(function(a,b) {
              return (+b._id) - (+a._id);
            });

			for (var i = 0; i < search_posts.length; i++) {
			    if (search_posts[i]._source) {
			    	var the_thumb = search_posts[i]._source.featured_image['square-medium'].url;
			    	var the_thumb = the_thumb.replace('http://localhost:8888', 'http://cdn.elitedaily.com');
			    	var the_link = search_posts[i]._source.url.replace('http://localhost:8888', window.location.protocol + "//" + window.location.host);

                    // Format Date
                    var the_date = search_posts[i]._source.date;
                    the_date = the_date.replace(/-/g,"/");
                    var unix_date = new Date(the_date);
                    var month = unix_date.getUTCMonth() + 1;
                    var date = unix_date.getUTCDate();
                    var year = unix_date.getUTCFullYear();
                    var formatted_date = month + '/' + date + '/' + year;


                    // var date_parts = the_date.split(' ');
                    // var formatted_date = date_parts[0];
                    // var formatted_date = formatted_date.replace(/-/g,'/');

			        $('#search-result-list').show();
			        $('#search-result-list ul').append('<li><img src="' + the_thumb + '" class="result-thumbnail"><h1><a href="' + the_link + '">' + search_posts[i]._source.title_plain + '</a></h1><span class="search-result-time">'+ formatted_date +'</span></li>');
			        wordslist = searchVal.split(/[ ,]+/);
			        for (z = 0; z < wordslist.length; z++) {
			            $('#search-result-list ul').highlight(wordslist[z]);
			        }
			    }

			};
		});
    },

    search_result_offset: function() {
        billboardHeight = $('.billboard-wrapper').height();
        navHeight = $('.nav-outer-wrapper').height();

        if ($('.header-billboard').length > 0) {
            $('.sl-modal-screen').css({
                'top': navHeight + billboardHeight
            });
        } else {
            $('.sl-modal-screen').css({
                'top': navHeight
            });
        }
    },

    lock_modal_scroll: function() {
        $('.sl-modal-screen').bind('mousewheel DOMMouseScroll touchmove', function(e) {
            var e0 = e.originalEvent,
                delta = e0.wheelDelta || -e0.detail;

            this.scrollTop += (delta < 0 ? 1 : -1) * 30;
            e.preventDefault();
        });
        $('body').css('overflow', 'hidden');
    },

    // Will be Deprecated soon
    elastic_search_results: function() {
        // $(document).unbind();
        $(document).bind("keyup", function(e) {
            e.preventDefault();
            if (e.which <= 90 && e.which >= 48) {
                var searchVal = $('#nav-search-input').val();
                if (searchVal.length > 3) {

                    var searchUrl = '/?elasticsearch=get_search_results&search=' + searchVal;

                    $('#search-result-list ul').html('');

                    $.getJSON(searchUrl, function(data) {
                        //console.log(data);

                        billboardHeight = $('.billboard-wrapper').height();
                        navHeight = $('.nav-outer-wrapper').height();

                        if ($('.header-billboard').length > 0) {
                            $('.sl-modal-screen').css({
                                'top': navHeight + billboardHeight
                            });
                        } else {
                            $('.sl-modal-screen').css({
                                'top': navHeight
                            });
                        }

                        $('.sl-modal-screen').fadeIn(function() {

                            // Resize Results Window
                            function resizeResults() {
                                windowHeight = $(window).height();
                                $('.search-area').css({
                                    'height': windowHeight - 50 + 'px'
                                });
                            }
                            $(document).ready(function() {
                                resizeResults();
                            });
                            window.onresize = function(event) {
                                resizeResults();
                            }

                            // Keeps Scrolling Within Results Div
                            $('.sl-modal-screen').bind('mousewheel DOMMouseScroll', function(e) {
                                var e0 = e.originalEvent,
                                    delta = e0.wheelDelta || -e0.detail;

                                this.scrollTop += (delta < 0 ? 1 : -1) * 30;
                                e.preventDefault();
                            });

                            for (var i = 0; i < data.posts.length; i++) {
                                if (data.posts[i]._source) {
                                    var the_thumb = data.posts[i]._source.image_thumbnail;
                                    var the_thumb = the_thumb.replace('http://localhost:8888', 'http://cdn.elitedaily.com');
                                    $('#search-result-list').show();
                                    $('#search-result-list ul').append('<li><h1><img src="' + the_thumb + '" class="result-thumbnail"><a href="' + data.posts[i]._source.url + '">' + data.posts[i]._source.title_plain + '</a></h1></li>');
                                    wordslist = searchVal.split(/[ ,]+/);
                                    for (z = 0; z < wordslist.length; z++) {
                                        $('#search-result-list ul').highlight(wordslist[z]);
                                    }
                                }

                            };
                        });
                    });
                }
            }
        });
    },

    mobile_menu: function() {
        $(document).on('touchstart click', '.mobile-menu', function(e) {
            e.stopPropagation();
            var prevent_double_click = false;
            // prevents clicking on hamburger icon triggering a menu option
			if (!prevent_double_click) {
				prevent_double_click = true;
				setTimeout(function(){
					prevent_double_click = false;
				}, 100);
                $(this).toggleClass('icon-ed-hamburger icon-ed-close');
	            $('.main-nav').addClass('show-menu');
	            $('.outer-content-wrapper').addClass('show-menu');
	            $('.mobile-section-wrapper').addClass('show-menu').show();
	            $('.sl-modal-screen').addClass('show-menu transparent').show();
	            site_nav.lock_modal_scroll();
	            site_nav.mobile_menu_close();
			}
            return false;
        });
    },

    mobile_menu_close: function() {
    	// Close Mobile Menu
        close_that_menu = {
            close: function (){
                $('body').css('overflow', 'auto');
                $('.mobile-menu.icon-ed-close').toggleClass('icon-ed-hamburger icon-ed-close');
                $('.sl-modal-screen').removeClass('show-menu transparent').hide();
                $('.main-nav').removeClass('show-menu');
                $('.outer-content-wrapper, .mobile-section-wrapper').removeClass('show-menu');

                setTimeout(function() {
                    $('.mobile-section-wrapper').hide();
                }, 300);
            }
        }

        $(document).on('touchstart click', '.sl-modal-screen.show-menu.transparent', function(e) {
            if (e.type == 'touchstart' || e.type == 'touchend') {
                e.preventDefault();
            }
            e.stopPropagation();
            close_that_menu.close();
        });
        $(window).resize(function (){
            close_that_menu.close();
        });
    },

    nav_shadow: function(offsetElement) {
        if (offsetElement == undefined) {
            offsetDomElement = $('.outer-content-wrapper');
        } else {
            offsetDomElement = $('.' + offsetElement);
        }
        $(window).scroll(function() {
            if ($(window).scrollTop() + $('.main-nav').height() > offsetDomElement.offset().top + 20) {
                $('.nav-wrapper').addClass('nav-shadow');
                // if (typeof dropDownOpen != 'undefined') {

                //     if (dropDownOpen === true) {
                //         $('.nav-wrapper').removeClass('nav-shadow');
                //     } else {
                //         $('.nav-wrapper').addClass('nav-shadow');
                //     }

                // } else {
                //     $('.nav-wrapper').addClass('nav-shadow');
                // }

            } else {
                $('.nav-wrapper').removeClass('nav-shadow');
            }
        });
    },

    login_modal: function(element, callback) {
        $(document).on('click touchstart', element, function(e) {
            if ($('body').hasClass('logged-in')) {
                // do nothing yet

            } else {
                e.preventDefault();

                $('.lwa-register').show();
                site_nav.fade_in_screen(callback);
                $('.lwa-links-register-inline').on('click touchstart', function() {
                    $('.lwa-register').show();
                    $('.flip-container .front').fadeOut(function() {
                        $('.flip-container .back').fadeIn();
                    });
	            });
	            $('.lwa-links-register-inline-cancel').on('click touchstart', function() {
	                $('.lwa-register').show();
                    $('.flip-container .back').fadeOut(function() {
                        $('.flip-container .front').fadeIn();
                    });
	            });
            }
        });
    },

    newsletter_modal: function(element, callback) {
        $(document).on('click touchstart', element, function(e) {
            e.preventDefault();
            site_nav.fade_in_screen(callback);
        });
    },

    login_page: function(callback) {
        if ($('body').hasClass('login')) {
            $('.lwa-links-register-inline').on('click touchstart', function() {
                $('.lwa-register').show();
                $('.flip-container .front').fadeOut(function() {
                    $('.flip-container .back').fadeIn();
                });
            });
            $('.lwa-links-register-inline-cancel').on('click touchstart', function() {
                $('.lwa-register').show();
                $('.flip-container .back').fadeOut(function() {
                    $('.flip-container .front').fadeIn();
                });
            });
        }
    },

    info_modal: function(callback) {
        $('.util-nav li.more-header').on('click touchstart', function(e) {
            e.preventDefault();
            site_nav.search_close();
            site_nav.fade_in_screen(callback);
        });
    },

    email_modal: function(callback) {
        $('.email-share').on('click touchstart', function(e) {
            e.preventDefault();
            site_nav.search_close();
            site_nav.fade_in_screen(callback);
        });
    },

    fade_in_screen: function(callback) {
        $('body').css('overflow', 'hidden');
        if ($('.sl-modal-screen').is(":visible")) {

        } else {
            $('.sl-modal-screen').fadeIn();
        }
        callback();
    },

    modal_callback: function(element, elementClass) {
        $(element).show(function() {
            $(element).addClass(elementClass);
        });
        site_nav.close_modal();
    },

    close_modal: function(callback) {
        var modalContainers = $(".sl-modal-inner");
        $(document).on('mouseup tap', function(e) {
            if (!modalContainers.is(e.target) && modalContainers.has(e.target).length === 0 || $('.sl-close').is(e.target)) {
                $('.sl-modal-screen').fadeOut(function() {
                    modalContainers.removeClass('centered-login').hide();
                    callback();
                });
            }
        });
        $(document).keyup(function(e) {
            if (e.keyCode == 27) {
                $('.sl-modal-screen').fadeOut(function() {
                    modalContainers.removeClass('centered-login').hide();
                });
            }
        });
        $('body').css('overflow', 'inherit');
    },

    show_login: function() {
        return site_nav.modal_callback('#section-sl-login', 'centered-login');
    },

    show_info: function() {
        return site_nav.modal_callback('#section-sl-info-modal', 'centered-login');
    },

    show_email: function() {
        return site_nav.modal_callback('#section-sl-email-modal', 'centered-login');
    },

    show_newsletter: function() {
        return site_nav.modal_callback('#section-sl-newsletter', 'centered-login');
    },

    fixed_header: function() {
        var navHeader = $('.logo-header');

        adFixHead = 0;
        transition = 'none';

        setTimeout(function() {
            adFixHead = 1;
            contentOffset = site_nav.get_nav_height();
            adHeight = site_nav.get_ad_height();
            transition = 'all, .3s, ease-out';
            site_nav.persistant_ad_header(adFixHead, contentOffset, adHeight, transition);
        }, 4000);

        setTimeout(function() {
            transition = 'none';
        }, 4300);

        contentOffset = site_nav.get_nav_height();
        adHeight = site_nav.get_ad_height();
        site_nav.persistant_ad_header(adFixHead, contentOffset, adHeight, transition);

        $(window).scroll(function() {
            contentOffset = site_nav.get_nav_height();
            adHeight = site_nav.get_ad_height();
            site_nav.persistant_ad_header(adFixHead, contentOffset, adHeight, transition);
        });
    },

    get_nav_height: function() {
        var navHeight = $('.main-nav').height();
        return navHeight;
    },

    get_ad_height: function() {
        var adHeight = $('.billboard-wrapper').height();
        return adHeight;
    },

    persistant_ad_header: function(adFixHead, contentOffset, adHeight, transition) {
        var scrTop = $(window).scrollTop();

        if (adFixHead == 0) {
            adHeight = 0;
        }

        if (scrTop > adHeight) {
            $('.main-nav').css({
                'position': 'fixed',
                'top': '-' + adHeight + 'px',
                'transition': transition
            });
            $('.outer-content-wrapper').css({
                'position': 'relative',
                'top': contentOffset + 'px',
                'transition': 'none'
                    // 'top':'0px'
            });
        } else {
            $('.main-nav').css({
                'position': 'relative',
                'top': '0px',
                'transition': 'none'
            });
            $('.outer-content-wrapper').css({
                'position': 'relative',
                // 'top': contentOffset + 'px'
                'top': '0px',
                'transition': 'none'
            });
        }
    },

    article_header: function (){
        var articleTitle = $('.main-story h1').html();
        $('.article-nav h2').html(articleTitle);
        $(window).scroll(function() {
            var scrollTop = $(window).scrollTop();
            if ($('.below').length > 0) {
                var belowOffset = $('.below').offset().top;
            }
            if (scrollTop > belowOffset) {
                $('.article-nav').css({
                    'top': '-120px'
                });
                $('.related-nav').css({
                    'top': '-120px'
                });
                $('li.sub-tab').removeClass('selected');
                $('li.related').addClass('selected');
            } else if (scrollTop > adHeight) {
                site_nav.section_close();
                $('.home-nav').css({
                    'top': '-100px'
                });
                $('.article-nav').css({
                    'top': '-60px'
                });
                $('.related-nav').css({
                    'top': '0'
                });
            } else {
                $('.home-nav').css({
                    'top': '0px'
                });
                $('.article-nav').css({
                    'top': '0px'
                });
            }
        });
    },

    leave_window: function (){
        var finish_count = 0;
        setTimeout(function() {
            finish_count++;
        }, 30000);
        $('body').mouseleave(function() {
            // cursor has left the building
            //console.log(finish_count);
            if (finish_count == 1 && !strangelove.is_current_page('logged-in') && !$('.sl-modal-screen').is(":visible")) {
                // site_nav.fade_in_screen(site_nav.show_login);
                //site_nav.fade_in_screen(site_nav.show_newsletter);
            }
        });
    },

    set_related_active: function(){
        $(window).scroll(function(){
            var relatedOffset = $('.related-content-wrapper').offset().top - 60;
            var trendingOffset = $('.trending-content-wrapper').offset().top - 60;
            var latestOffset = $('.latest-content-wrapper').offset().top - 60;
            if ($(window).scrollTop() > latestOffset) {
                $('li.sub-tab').removeClass('selected');
                $('li.latest').addClass('selected');
            } else if ($(window).scrollTop() > trendingOffset) {
                $('li.sub-tab').removeClass('selected');
                $('li.trending').addClass('selected');
            } else if ($(window).scrollTop() > relatedOffset) {
                $('li.sub-tab').removeClass('selected');
                $('li.related').addClass('selected');
            } else {
                $('li.sub-tab').removeClass('selected');
            }
        });
    },

    smooth_scroll: function (){
      $('a[href*=#]:not([href=#])').click(function() {
        if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'') && location.hostname == this.hostname) {
          var target = $(this.hash);
          target = target.length ? target : $('[name=' + this.hash.slice(1) +']');
          if (target.length) {
            $('html,body').animate({
              scrollTop: target.offset().top - 55
            }, 1000);
            return false;
          }
        }
      });
    },

    hide_mobile_nav: function (){
        // var newURL = window.location.protocol + "//" + window.location.host + window.location.pathname;
        var newURL = $('.mobile-circle-share').data('url');
        var postTitle = $('.main-story h1').html();
        if (sl_window_width < 768){

            var lastScrollTop = 0;

            $(window).scroll(function (){
                var st = $(window).scrollTop();
                if (st > lastScrollTop && st > 220) {
                    // console.log('hidenav');
                    $('.main-nav').addClass('nav-hide');
                } else {
                    // console.log('shownav');
                    $('.main-nav').removeClass('nav-hide');
                }

                // Sticky Share Btn
                // if ($('body').hasClass('single')){
                //     if (st > $('.mobile-top-article-share').offset().top && st < $('.bottom-article-share').offset().top - $(window).height() - 50){
                //         $('.mobile-circle-share').show();
                //         site_nav.mobile_social_referrer(document.referrer, newURL, postTitle);
                //     } else {
                //         $('.mobile-circle-share').hide();
                //     }
                // }

                lastScrollTop = st;
            });
        }
    },

    mobile_subnav: function (){
        // var newURL = window.location.protocol + "//" + window.location.host + window.location.pathname;
        // var newURL = $('.mobile-circle-share').data('url');

        if (sl_window_width < 768){

            var lastScrollTop = 0;

            if ($('body').hasClass('home')){
                $(window).scroll(function (){
                    var st = $(window).scrollTop();
                    if (st > lastScrollTop && st > 220) {
                        $('.main-nav').addClass('nav-hide');
                    } else {
                        $('.main-nav').removeClass('nav-hide');
                    }

                    lastScrollTop = st;
                });

            }
            else if ($('body').hasClass('single')){

                site_nav.mobile_subnav_buttons();

                site_nav.mobile_subnav_switch_menu();
            }

        }
    },

    mobile_subnav_buttons: function (){

        var ref = document.referrer;
        var theUrl = $('.mobile-article-subnav').data('url');
        var twHashtag = $('.article-sharing .tw-share').data('hashtag');
        var theShareCount = $('.total-share-count').data('share-count');
        var theShareCountAbbr = $('.total-share-count').data('share-count-converted');
        var postTitleText = $('.main-story h1').text();

        // Choose Twitter Button if coming from twitter app, ELSE: choose facebook
        if (ref.indexOf("twitter") > -1 || ref.indexOf("t.co") > -1){
            $('.subnav-share-btns').prepend('<a href="https://twitter.com/share?url=' + theUrl + '&text=' + postTitleText + '&via=EliteDaily' + twHashtag + '" target="_blank" class="feat-subnav-btn mobile-subnav-btn mobile-subnav-share icon-ed-social-twitter-1"><span>Tweet</span></a>');
        } else {
            $('.subnav-share-btns').prepend('<a href="https://www.facebook.com/sharer/sharer.php?u=' + theUrl + '" target="_blank" class="feat-subnav-btn mobile-subnav-btn mobile-subnav-share icon-ed-social-facebook"><span>Share</span></a>');
        }

        $('.subnav-share-btns').append('<a href="#comment-area" class="mobile-subnav-btn mobile-subnav-share icon-ed-comment-filled"></a>');

        // Add More Button
        $('.subnav-share-btns').append('<div class="mobile-subnav-btn mobile-subnav-more icon-ed-plus"></div>');
        site_nav.mobile_subnav_more(theUrl, postTitleText, twHashtag);


        // Check share number
        if ($(window).width() > 320){
            if (parseInt(theShareCount) > 100){
                $('.mobile-article-subnav').append('<div class="subnav-share-count"><span class="subnav-share-number">' +  theShareCountAbbr + '</span><span class="subnav-share-text">Shares</span></div>');
            } else {
                setTimeout(function(){
                    var theShareCountAbbr = $('.total-share-count').data('share-count-converted');
                    var theShareCount = $('.total-share-count').data('share-count');
                    // Check share number
                    if (parseInt(theShareCount) > 100){
                        $('.mobile-article-subnav').append('<div class="subnav-share-count"><span class="subnav-share-number">' +  theShareCountAbbr + '</span><span class="subnav-share-text">Shares</span></div>');
                    } else {
                        $('.mobile-article-subnav').append('<div class="subnav-share-count"><span class="default-share-msg">Share With</span><span class="default-share-msg">Your Friends</span></div>');
                        $('.subnav-share-count').css({'margin-top':'14px'});
                    }
                }, 1000);

            }
        }

    },

    mobile_subnav_more: function (url, title, hashtag){
        $(document).on('click touchend', '.mobile-subnav-more', function() {
            var ref = document.referrer;
            // $('.mobile-subnav-title').hide();
            setTimeout(function(){
                $('.mobile-subnav-more').hide();
                $('.feat-subnav-btn span').hide();
                if (ref.indexOf("twitter") > -1 || ref.indexOf("t.co") > -1){
                    $('.subnav-social-share').append('<a href="https://www.facebook.com/sharer/sharer.php?u=' + url + '" target="_blank" class="mobile-subnav-btn mobile-subnav-share icon-ed-social-facebook"></a>');
                } else {
                    $('.subnav-social-share').append('<a href="https://twitter.com/share?url=' + url + '&text=' + title + '&via=EliteDaily' + hashtag + '" target="_blank" class="mobile-subnav-btn mobile-subnav-share icon-ed-social-twitter-1"></a>');
                }

                $('.subnav-social-share').append('<a href="whatsapp://send?text=' + title + ' ' + url + '" class="wa_btn mobile-subnav-btn mobile-subnav-share icon-ed-social-whatsapp"></a>');
                // $('.subnav-social-share').append('<a href="http://www.linkedin.com/shareArticle?mini=true&amp;url=' +  url  + '&title=' + title + '&source=Elite Daily" target="_blank" class="mobile-subnav-btn mobile-subnav-share icon-ed-social-linkedin"></a>');
                $('.subnav-social-share').append('<a href="mailto:?subject=Elite Daily: ' + title + '&body=' + url + '" class="mobile-subnav-btn mobile-subnav-share icon-ed-email-fill"></a>');

                $('.mobile-subnav-btn').css({'float':'left', 'margin-right':'5px', 'margin-left':'0'});

                if ($(window).width() < 320){
                    $('.subnav-share-count').hide();
                }
            }, 600);
        });
    },

    mobile_subnav_switch_menu: function (){
        // On Scroll Switch Menu
        $(window).scroll(function (){
            var st = $(window).scrollTop();
            if ($('.below').length > 0) {
                if (st > 220 && st < $('.below').offset().top) {
                    $('.nav-inner-wrapper').addClass('top-nav-hide');
                    $('.mobile-article-subnav').addClass('sub-nav-show');

                } else {

                    $('.nav-inner-wrapper').removeClass('top-nav-hide');
                    $('.mobile-article-subnav').removeClass('sub-nav-show');
                }

            }

            lastScrollTop = st;
        });
    },

    mobile_social_referrer: function (ref, url, title){
        if (ref.indexOf("facebook") > -1) {
            $('.mobile-circle-share').addClass('icon-ed-social-facebook-fill');
            $('.mobile-circle-share').attr('href', 'https://www.facebook.com/sharer/sharer.php?u=' + url);

        } else if (ref.indexOf("twitter") > -1 || ref.indexOf("t.co") > -1) {
            $('.mobile-circle-share').addClass('icon-ed-social-twitter-1');
            $('.mobile-circle-share').attr('href', 'https://twitter.com/share?url=' + url + '&text=' + title + '&via=EliteDaily');

        }
        // else {
        //     $('.mobile-circle-share').addClass('icon-ed-social-facebook-fill');
        //     $('.mobile-circle-share').attr('href', 'https://www.facebook.com/sharer/sharer.php?u=' + url);
        // }
    }

}

var site_sidebar = {
    stick_trending_widget: function (){
    	if ($('.trending-widget-sidebar').length){

	        if (strangelove.get_window_width() > 1024){
			    $(window).scroll(function() {
			    	site_sidebar.home_trending_stick();
			    });
			}

	        $(window).resize(function(){
		        if (strangelove.get_window_width() > 1024){
		        	site_sidebar.home_trending_stick();
		        }
	        });
    	}
    },

    home_trending_stick: function (){
	    trendingOffset = $('.sidebar-line-break').offset().top - 70;
        if ($(window).scrollTop() > trendingOffset) {
            $('.trending-widget-sidebar').css({
                'position': 'fixed',
                'top': '70px'
            });
            $('#home-sticky-ad').css({
                // 'position': 'fixed',
                // 'bottom': '0px'
                'display': 'block',
                'position': 'fixed'
            });
        } else {
    		// trendingOffset = $('.trending-widget-sidebar').offset().top - 70;
            $('.trending-widget-sidebar').css({
                'position': 'relative',
                'top': 'auto'
            });
            $('#home-sticky-ad').css({
                // 'position': 'fixed',
                // 'bottom': '-500px',
                'position': 'relative'                             
            });
        }
    },

	sidebar_scroll: function (){
		if ($('.ad-rectangle-unit').length){

	    	if (strangelove.get_window_width() > 1024){
			    site_sidebar.fixed_sidebar();

			    $(window).scroll(function() {
			        site_sidebar.fixed_sidebar();
			    });
			}

		    $(window).resize(function() {
		    	if (strangelove.get_window_width() > 1024){
			        site_sidebar.fixed_sidebar();
		    	}
		    });
		}
	},

	fixed_sidebar: function (){
	    var currentScrollTop = $(window).scrollTop();
	    var relatedOffset = $('.below').offset().top;
	    var windowHeight = $(window).height();
	    var listOffset = $('.sidebar-line-break').offset().top - 70;
	    if (currentScrollTop > relatedOffset - windowHeight) {
	        $('.ad-rectangle').css({
	            'position': 'absolute',
	            'bottom': '0px',
	            'display': 'block'
	        });
	    } else if (currentScrollTop > listOffset) {
	        $('.trending-widget-sidebar').css({
	            'position': 'fixed',
	            'top': '70px'
	        });
	        $('.ad-rectangle').css({
	            'position': 'fixed',
	            'bottom': '0px',
	            'display': 'block'
	        });
	    } else {
		    listOffset = $('.trending-widget-sidebar').offset().top - 70;
	        $('.trending-widget-sidebar').css({
	            'position': 'relative',
	            'top': 'auto'
	        });
	        $('.ad-rectangle').css({
	        	'display': 'block',
	        	'position': 'relative'
	        });
	    }
	},

	limit_featured_posts: function (){
		var available_space = $(window).height() - 60 - 320;
		var number_of_posts = parseInt(available_space / 70);
		var number_of_posts = number_of_posts + 1;
		trending_array = [];
		for (var i = 1; i < number_of_posts + 1; i++) { // Display Visible Posts
			$('#featured-post-'+i).css({'display':'block'});
		};

		for (var y = 2; y <= 15; y++) { // Number of featured posts
			var featured_id = $('#featured-post-'+y).data('pid');
			trending_array.push(featured_id);				
		};

	},

	author_activity: function (){
	    var colWidth = $('.author-column').width();
	    $('.author-column').css({
	        'width': colWidth
	    });

    	$(window).on('load resize', function() {
		    if ($(window).width() > 1024) {
	    		site_sidebar.fix_author_sidebar();
			}
		    $('.author-column').css({
		        'width': colWidth
		    });
    	});

	    $('h2').widowFix();
	},

	fix_author_sidebar: function (){

	    var offsetTop = $('.author-column').offset().top - 60;
	    offsetTop = $('#item-header').offset().top - 60;

        if ($(window).scrollTop() > offsetTop && $(window).width() > 1024) {
            $('.author-column').addClass('fixed');
        } else {
		    offsetTop = $('.author-column').offset().top - 60;
            $('.author-column').removeClass('fixed');
        }

	    $(window).on('load resize scroll', function() {
	        if ($(window).scrollTop() > offsetTop && $(window).width() > 1024) {
	            $('.author-column').addClass('fixed');
	        } else {
			    offsetTop = $('.author-column').offset().top - 60;
	            $('.author-column').removeClass('fixed');
	        }
	    });

	},

	truncate_title_sidebar: function (){
		$(window).on('load resize', function() {
			$('.large-side-article h3').dotdotdot();
			$('.small-side-article h3').dotdotdot();
		})
	},

	follow_text_hover: function (){
		// replaces following text on follow with x and unfollow
		button = $('.follow-button');

		button.on('touchstart mouseover', function (){
			if (button.hasClass('following') && button.text() == 'Following') {
				$(this).find('a.unfollow').text('Unfollow').addClass('unfollow-toggle');
			}
		});
		button.on('touchend mouseout', function (){
			if (button.hasClass('following') && button.text() != 'Following') {
				$(this).find('a.unfollow').text('Following').removeClass('unfollow-toggle');
			}
		});
	},

	follow_text_hover_no_a: function (){
		// replaces following text on follow with x and unfollow
		button = $('.follow-button');

		button.on('touchstart mouseover', function (){
			if (button.hasClass('following') && button.text() == 'Following') {
				$(this).text('Unfollow').addClass('unfollow-toggle');
			}
		});
		button.on('touchend mouseout', function (){
			if (button.hasClass('following') && button.text() != 'Following') {
				$(this).text('Following').removeClass('unfollow-toggle');
			}
		});
	},

	remove_bookmark_hover: function (){
		// unfav hover replace text with x & remove
		unfav_button = $('.activity-meta .unfav, .bookmark-wrapper .unfav');

		unfav_button.on('touchstart mouseover', function (){
			if (unfav_button) {
				$(this).text('Remove').addClass('expanded');
			}
		});
		unfav_button.on('touchend mouseout', function (){
			if (unfav_button) {
				$(this).text('Saved').removeClass('expanded');
			}
		});
	},

	remove_blank_paragraphs: function (){
		// removes blank p tags in author info
		if ($(".author-info p:empty").length > 0) {
		    $(".author-info p:empty").remove();
		}

	}

}

var site_content = {
    default_author_image: function (){
	    $('img.author-thumb-image, img.author-image, img.member-avatar').on('error', function() {
	        $(this).attr('src', '/wp-content/themes/strangelove/images/default-author.jpg');
	    });
    },

    default_content_image: function (){
    	$('.thumb-img-wrapper img').on('error', function(){
    		$(this).attr('src', '/wp-content/themes/strangelove/images/fallbacks/ed-fallback-post-2x.jpg');
    	});
    },

    convert_dates: function (element){
    	if (element == undefined) { element = 'time'; }
		$(element).timeago();
    },

    show_bookmark: function (){
	    if (sl_window_width > 768){
	        $(document).on('mouseenter', 'article', function(){
	            $(this).find('time').hide();
	            $(this).find('.bookmark-wrapper').fadeIn('fast');
	        }).on('mouseleave', 'article', function(){
	            $(this).find('.bookmark-wrapper').hide();
	            $(this).find('time').fadeIn('fast');
	        });
	    }
    },

    show_more_share_buttons: function (){
	    $(document).on('click touchstart', '.more-share.icon-ed-plus', function(){
	    	$('.total-share-count').hide();
	        $('.more-share').hide();
	        $('.li-share, .gp-share, .su-share, .rd-share, .bookmark-share').show();

	        // $(this).removeClass('icon-ed-plus').addClass('icon-ed-minus');
	        site_content.show_less_share_buttons();
	    });
    },

    show_less_share_buttons: function (){
	    $(document).on('click touchstart', '.more-share.icon-ed-minus', function(){
	        $('.li-share, .gp-share, .su-share, .rd-share, .bookmark-share').hide();
	        $(this).removeClass('icon-ed-minus').addClass('icon-ed-plus');
	    });
    },

	fit_video: function (){
	    $("article.main-story").fitVids();
	},

	fit_video_page: function(){
	    $(".two-third-article>.img-wrapper").fitVids();
	},

	fit_instagram: function (){
		$("iframe[src*='instagram.com']").wrap('<div class="ig-wrapper"></div>');
	},

	show_sources: function (){
	    // $('.article-sources').click(function() {
	    //     $('.citation-sources').fadeToggle(function() {
	    //         $('.citation-full-sources').fadeToggle();
	    //     })
	    // });
		$('.article-sources').on('click tap', function (){
			$(this).find('.icon-ed-dropdown').toggleClass('rotate');
			$(this).find('.citation-sources').fadeToggle(300);
			$(this).find('.citation-wrapper').slideToggle('300', function (){
				$(this).find('.citation-full-sources').toggleClass('visible');
			});
		})
		$('.citation-wrapper a').on('click tap', function (e){
			e.stopPropagation();
		});
	},

	show_comments: function (){
		$('.comment-box .comment-expand').on('click tap', function (e){
			e.preventDefault();
			$('.show-comment-list li').slideDown('300', function (){
				$('.comment-list').toggleClass('visible');
				$('.comment-box .comment-expand').fadeOut();
			});
		})
	},

	show_more_author_info: function (){
		var height = $('.expand-bio-details').outerHeight();
		$('.expand-bio-details').css('height', height + 'px').hide();

		set_that_height = {
			init: function (){
				dropdownOpen = false;
				$('.author-info-wrapper').on('click tap', function (e){
					if (e.target.nodeName != 'A') {
						e.preventDefault();
						set_that_height.links_pass_through();
					}
					if ( dropdownOpen === true ) {
						$(this).find('.expand-bio-details').slideUp('300', function (){
							$(this).find('.expand-bio-inner-wrapper').removeClass('visible');
						});
						$('.author-info .icon-ed-dropdown').removeClass('rotate');
						dropdownOpen = false;
					} else {
						$(this).find('.expand-bio-details').slideDown('300', function (){
							$(this).find('.expand-bio-inner-wrapper').addClass('visible');
						});
						$('.author-info .icon-ed-dropdown').addClass('rotate');
						dropdownOpen = true;
					}
				});
			},
			links_pass_through: function (){
				$('.author-info-wrapper h2 a').on('click tap', function (e){
				    e.stopPropagation();
				});
			}
		}
		if ($(window).width() < 639) {
		   set_that_height.init();
		}

	},

	equal_height: function (container){
        var currentTallest = 0,
            currentRowStart = 0,
            rowDivs = new Array(),
            $el,
            topPosition = 0;

        $(container).each(function() {
            $el = $(this);
            $($el).height('auto')
            topPostion = $el.position().top;

            if (currentRowStart != topPostion) {
                for (currentDiv = 0; currentDiv < rowDivs.length; currentDiv++) {
                    rowDivs[currentDiv].height(currentTallest);
                }
                rowDivs.length = 0;
                currentRowStart = topPostion;
                currentTallest = $el.height();
                rowDivs.push($el);
            } else {
                rowDivs.push($el);
                currentTallest = (currentTallest < $el.height()) ? ($el.height()) : (currentTallest);
            }
            for (currentDiv = 0; currentDiv < rowDivs.length; currentDiv++) {
                rowDivs[currentDiv].height(currentTallest);
            }

        });
	},

	equalize_heights: function (){
	    $(window).load(function() {
	        site_content.equal_height('.equalize-height');
	        $('.equalize-height').addClass('visible');
	    });

	    $(window).resize(function() {
	        site_content.equal_height('.equalize-height');
	        $('.equalize-height').addClass('visible');
	    });
	},

	equalize_content_height: function (){
		site_content.equal_height('.sl-grid-height');

	},
	set_topic_bg: function (element){
	   var imgUrl = $(element).data('bgSrc');
	   $(element).css({'background-image': 'url("'+imgUrl+'")'});
	   site_content.custom_topic_header();
	},

	photo_zoom: function (){
        $('body.single #content .entry-content').magnificPopup({
            delegate: 'img',
            type: 'image',
            closeBtnInside: false,
            closeOnContentClick: false,
            mainClass: 'mfp-with-zoom',
            zoom: {
                enabled: true,
                duration: 300, // we use 300 for almost all animations
                easing: 'ease-in-out',
                opener: function(openerElement) {
                    return openerElement.is('img') ? openerElement : openerElement.find('img');
                }
            },
            callbacks: {
                open: function (){
                    var self = this;
                    self.wrap.on('click.pinhandler', 'img', function() {
                        self.wrap.toggleClass('mfp-force-scrollbars');
                    });
                },
                beforeClose: function (){
                    this.wrap.off('click.pinhandler');
                    this.wrap.removeClass('mfp-force-scrollbars');
                },
                elementParse: function(item) {
                    item.src = item.el.attr('src');
                }
            },
            image: {
                verticalFit: false
            }
        });
	},

	init_photo_zoom: function (){
		$(window).load(function (){
		    if ($(window).width() > 599) {
		        site_content.photo_zoom();
		        if (strangelove.is_current_page('single')) {
		            $('body.single #content .entry-content img').each(function() {
		                $(this).addClass('zoom');
		            });
		        }
		    }
		});

		$(window).resize(function (){
		    if ($(window).width() > 599) {
		        site_content.photo_zoom();
		        if (strangelove.is_current_page('single')) {
		            $('body.single #content .entry-content img').each(function() {
		                $(this).addClass('zoom');
		            });
		        }
		    }
		});
	},

	strip_parenthesis: function (){
	    for (var i = 0; i < $('h2 a').length; i++) {
	        var newtext = $('h2 a').eq(i).html().replace('(Video)', '');
	        $('h2 a').eq(i).html(newtext);
	    };
	},

	show_comment_button: function (){
		var expand_box = 0;
		$('.comment-form-comment textarea').focus(function(){
			$('.form-submit').show();
			expand_box = 1;
			if (expand_box == 1){
				$('.comment-form-comment textarea').css({'height':'100px'});
			}
		});
	},

	toggle_accordion: function (){
		$('.accordion-navigation a').on('click', function (e){
			e.preventDefault();
			$(this).toggleClass('rotate').parent().toggleClass('selected');
			$(this).parent('.accordion-navigation').find('.toggle-accordion').slideToggle('300', function (){
				$(this).find('.content-p').toggleClass('visible');
			});
		})
	},

	sponsored_truncate: function (){
		$('.sponsored-description').dotdotdot();
		$(window).resize(function (){
			$('.sponsored-description').dotdotdot();
		});
	},

	video_truncate: function (){
		$('.page-video-feature .entry-content p').dotdotdot();
		$(window).resize(function (){
			$('.page-video-feature .entry-content p').dotdotdot();
		});
	},

	mobile_read_more_author_description: function (){
		var desc = $('.author-description');
		var full_text = $('.author-description-full').text();

		if (full_text.length > 0) {
			$('.read-more, .author-description').on('click tap', function (){
				desc.replaceWith('<p class="author-description open">' + full_text + '</p>');
				$('.read-more').hide();
			});
		}

	},

	magnific_popup: function (){
		// Pop Up Over Content Images (excluding featured images)
	    $(document).ready(function() {
	        $('.popup-with-form').magnificPopup({
	          type: 'inline',
	          preloader: false,
	          focus: '#name',

	          // When elemened is focused, some mobile browsers in some cases zoom in
	          // It looks not nice, so we disable it:
	          callbacks: {
	            beforeOpen: function() {
	              if($(window).width() < 700) {
	                this.st.focus = false;
	              } else {
	                this.st.focus = '#name';
	              }
	            }
	          }
	        });
    	});

	},

	lazy_load_init: function() {
		$( 'img[data-lazy-src]' ).bind( 'scrollin', { distance: 200 }, function() {
			site_content.lazy_load_image( this );
		});

		// We need to force load gallery images in Jetpack Carousel and give up lazy-loading otherwise images don't show up correctly
		$( '[data-carousel-extra]' ).each( function() {
			$( this ).find( 'img[data-lazy-src]' ).each( function() {
				site_content.lazy_load_image( this );
			} );
		} );

		// site_content.lazy_load_backup();
	},

	lazy_load_image: function( img ) {
		var $img = jQuery( img ),
			src = $img.attr( 'data-lazy-src' );

		$img.unbind( 'scrollin' ) // remove event binding
			.hide()
			.removeAttr( 'data-lazy-src' )
			.attr( 'data-lazy-loaded', 'true' );

		img.src = src;
		$img.fadeIn();

	},

	lazy_load_backup: function (){
    	$('img').on('error', function(){
    		// console.log('lazy image error');
    		var backup_img = $(this).data('lazyBackup');
    		$(this).attr('src', backup_img);
    	});
	},

	longform_fitvids: function(){
		for (var i = 0; i < global_vid_selectors.length; i++) {

			$(".main-story p "+global_vid_selectors[i]).parents('p').addClass('longform-video');
			$('.main-story p').fitVids();
		};
	},

	heading_widows: function(){
		$('.main-story h2').widowFix();
	},

	fb_share_this: function (url, winWidth, winHeight){
        var winTop = (screen.height / 2) - (winHeight / 2);
        var winLeft = (screen.width / 2) - (winWidth / 2);
        window.open('http://www.facebook.com/sharer/sharer.php?u=' + url + '&', 'sharer', 'top=' + winTop + ',left=' + winLeft + ',toolbar=0,status=0,width=' + winWidth + ',height=' + winHeight);
	},

	load_pinterest: function (){
		if (sl_window_width > 768){
			(function(d){
			    var f = d.getElementsByTagName('SCRIPT')[0], p = d.createElement('SCRIPT');
			    p.type = 'text/javascript';
			    p.async = true;
			    p.src = '//assets.pinterest.com/js/pinit.js';
			    // p.setAttribute('data-pin-hover', true);
			    // p.setAttribute('data-pin-shape', 'round');
			    // p.setAttribute('data-pin-height', 32);
			    f.parentNode.insertBefore(p, f);
			}(document));
		}
	},

	wrap_image_share: function (){
		// site_content.load_pinterest();
		var thisTitle = $('.main-story h1').text();
		var thisPageUrl = escape(location.href);
		var featImgSrc = $('.feat-img-wrapper img').data('lazyBackup');
		$('.feat-img-wrapper').append('<a href="//www.pinterest.com/pin/create/button/?url='+thisPageUrl+'&media='+featImgSrc+'&description='+thisTitle+'" class="pin-img-btn icon-ed-social-pinterest" target="_blank"></a>');
		for (var i = 0; i < $('.entry-content img').length; i++) {
			$('.entry-content img').eq(i).wrap(function(){
				return '<div id="content-img-'+i+'" class="share-img-wrapper"></div>';
			});
			var thisImgSrc = $('.entry-content img').eq(i).data('lazyBackup');
			$('.share-img-wrapper').eq(i).append('<a href="//www.pinterest.com/pin/create/button/?url='+thisPageUrl+'&media='+thisImgSrc+'&description='+thisTitle+'" class="pin-img-btn icon-ed-social-pinterest" target="_blank"></a>');
		};
	},

	wrap_image_share_btn: function (){

		// site_content.load_pinterest();
		var thisTitle = $('.main-story h1').text();
		var thisPageUrl = escape(location.href);
		var featImgSrc = $('.feat-img-wrapper img').data('lazyBackup');
		$('.feat-img-wrapper').append('<a href="//www.pinterest.com/pin/create/button/?url='+thisPageUrl+'&media='+featImgSrc+'&description='+thisTitle+'" class="pin-img-btn" target="_blank"></a>');
		for (var i = 0; i < $('.entry-content img').length; i++) {
			$('.entry-content img').eq(i).wrap(function(){
				return '<div id="content-img-'+i+'" class="share-img-wrapper"></div>';
			});
			var thisImgSrc = $('.entry-content img').eq(i).data('lazyBackup');
			$('.share-img-wrapper').eq(i).append('<a href="//www.pinterest.com/pin/create/button/?url='+thisPageUrl+'&media='+thisImgSrc+'&description='+thisTitle+'" class="pin-img-btn" target="_blank"></a>');
		};
	},

	load_all_images: function (callback){
		var pinnableImgs = $('img[data-lazy-src]');
		$( 'img[data-lazy-src]' ).unbind('scrollin').removeAttr( 'data-lazy-src' ).attr( 'data-lazy-loaded', 'true' );
		$.each( pinnableImgs, function(){
			$(this).attr('src', $(this).data('lazy-backup'));
		});
		setTimeout(function(){
			callback();
		}, 500);
	},

	flexslider: function () {
		$(window).load(function() {
		    $('.flexslider').flexslider({
		        animation: "slide"
		    });
		    if ($('.newsletter-wrapper').length > 0) {
		    	$('.newsletter-wrapper').addClass('visible');
		    }
		});
	},

	contributor_email_submit: function(){
		$('#contributor-email-form').submit(site_content.send_contributor_email);
	},
	send_contributor_email: function(){
		var contributorEmail = $(this).serialize();
		console.log(contributorEmail);
		$.ajax({
			type:"POST",
			action: "send_contrib_email",
			url: "/wp-admin/admin-ajax.php",
			data: contributorEmail,
			success:function(data){
				console.log(data);
				$(".contributor-article-cta").html('<span class="success-contributor-email">Thanks! You\'ll be receiving an email from us with a link to our application page.</span>');
			}
		});
		return false;
	},
	custom_topic_header: function(){
		if (ad_kvs['topic'] == 'rock-the-vote'){
			site_content.custom_rock_the_vote();
			$('.topic-cover-image').append(tpl['rock-the-vote']());				
			$(window).resize(site_content.custom_rock_the_vote);
		}
	},
	custom_rock_the_vote: function() {
		if (sl_window_width >= 1500 ) $('.topic-cover-image').css({ 'height': '400px', 'background-position': 'center center', 'background-size': 'cover', 'background-attachment': 'initial'});
		if (sl_window_width > 768 && sl_window_width < 1500) $('.topic-cover-image').css({'height': '350px', 'background-position':'100% 60px', 'background-size': 'initial', 'background-attachment': 'fixed'});
		if (sl_window_width <= 768) $('.topic-cover-image').css({'height': '350px', 'background-position':'center 60px', 'background-size': 'initial', 'background-attachment': 'fixed'});
	},

	video_page_popup: function (){
		yt_loaded = false;		
		$('.img-link-wrapper').click(function(e){
			if (sl_window_width > 768){
				e.preventDefault();
				var video_url = $(this).parent().parent('.video-article').data('video-url');
				site_nav.fade_in_screen(function(){
					$('#player-modal').css({'display':'block'});
					site_content.set_player_size();
					player.loadVideoByUrl(video_url);
			        site_nav.close_modal(function(){
			        	player.stopVideo();
			        });				
				});
			}	
		});	

		$(document).keyup(function(e) {
		  if (e.keyCode == 27) player.stopVideo();
		});					
	},

	set_player_size: function (){
		playerWidth = $('#player').width();
		playerHeight = playerWidth / 1.691573927;
		$('#player').css({'height': playerHeight});
	},

	video_page_get_youtube: function (){
		if (sl_window_width > 768 && yt_loaded === false){	
			var tag = document.createElement('script');

			tag.src = "https://www.youtube.com/iframe_api";
			var firstScriptTag = document.getElementsByTagName('script')[0];
			firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);	

			var player;
			yt_loaded = true;
		}
	},

	video_page_resize: function (){
		jQuery(window).resize(function(){
			site_content.set_player_size();
			site_content.video_page_get_youtube();
		});
	}

}
var pg_count = 0;
var player;
var vidId;

function onYouTubeIframeAPIReady() {
  player = new YT.Player('player', {
    height: Math.ceil(sl_window_width/1.641025641),
    width: sl_window_width,
    videoId: vidId,
    playerVars: { 'autoplay': 1 }
  });
} 

var site_data = {
    infinite_scroll: function (){
	   $('#infscrl-wrapper').infinitescroll({
	        loading: {
	            finished: undefined,
	            finishedMsg: "Finished!",
	            msg: null,
	            msgText: " ",
	            img: "/wp-content/themes/strangelove/images/circle-loader.gif",
	            selector: null,
	            speed: 'fast',
	            loadingText: "Loading new posts",
	            start: undefined
	        },
	        state: {
	            isDuringAjax: false,
	            isInvalidPage: false,
	            isDestroyed: false,
	            isDone: false, // For when it goes all the way through the archive.
	            isPaused: false,
	            currPage: 1
	        },
	        /* remove debug on production */
	        debug: false,
	        behavior: undefined,
	        nextSelector: "nav.page-nav div.post-previous a",
	        navSelector: "nav.page-nav",
	        extraScrollPx: 200,
	        itemSelector: "#infscrl-wrapper .article-wrapper",
	        animate: false,
	        pathParse: undefined,
	        dataType: 'html',
	        appendCallback: true,
	        bufferPx: 400,
	        errorCallback: function() {
	            //console.log('error');
	        },
	        infid: 0, //Instance ID
	        pixelsFromNavToBottom: undefined,
	        path: undefined, // Can either be an array of URL parts (e.g.["/page/", "/"]) or a function that accepts the page number andreturns a URL
	        prefill: true, // When the document is smaller than the window, load data until the document is larger or links are exhausted
	        maxPage: 20 // to manually control maximum page (when maxPage is undefined, maximum page limitation is not work)
	    }, function() {
        	// site_content.equalize_content_height();        	
	        site_content.convert_dates();
	        site_content.default_author_image();
	        pg_count++;
	        site_dfp_ads.repeating_feed_ad(pg_count);
	        // site_ads.repeating_feed_ad(pg_count);
	        bp_init_activity();
	        //$( 'body' ).trigger('post-load');
        	site_content.lazy_load_init();
	    });
    },

    get_trending_widget: function (tpl, stick){
	    site_data.get_trending_data(tpl);

	    if (stick == true || stick == undefined){
			site_sidebar.stick_trending_widget();
	    }
    },

    get_trending_data: function(tpl){
    	if ($('.trending-widget-list').length){
	    	var query_type = $('.trending-widget-list').data();
	    	if (query_type['pubdate'] != undefined && query_type['sort'] != undefined){
				$.getJSON('/wp-content/plugins/trending-is/proxy.php?pubdate='+query_type['pubdate']+'&sort='+query_type['sort'], function(data) {
				    // console.log(data);
				    site_data.store_trending_articles(data);
				    site_data.list_trending_articles(tpl, data);
				});
	    	}
    	}
    },

    store_trending_articles: function (data){
		// Store for Related Trending Posts
		var array_counter = 0;
		trending_array = [];
		for (key in data){
			if (typeof data[key]._id == 'string'){
		    	var trendingIDArray = data[key]._id.split('/');
		    	var trendingID = trendingIDArray[trendingIDArray.length - 2];
		    	var trendingInt = parseInt(trendingID);
			} else {
				var trendingInt = data[key]._id;
			}
			trending_array.push(trendingInt);
			if (++array_counter > 9) break;
		}
    },

    list_trending_articles: function (tpl, data){
		var available_space = $(window).height() - 60 - 320;
		var number_of_posts = parseInt(available_space / 70);
		var number_of_posts = number_of_posts + 1;
		// var number_of_posts = (strangelove.is_current_page('single')) ? number_of_posts + 1 : number_of_posts; // uncomment once trending api works again
		var counter = 0;
		for (key in data) {
		    var total_count = (data[key].value.total > 1000) ? numeral(data[key].value.total).format('0.0a') : data[key].value.total;
		    var total_count = (total_count == undefined) ? 0 : total_count;
		    if (++counter > number_of_posts) break;
		    article_url = (typeof data[key]._id == 'string') ? data[key]._id : data[key].value.link;
		    var trending_data = {
		    	article: data[key],
		    	article_link: article_url,
		    	total: total_count
		    };
		    // trending_data['article_link'] = data[key]._id;
		    // console.log(trending_data['total']);
		    $('.trending-widget-list').append(tpl['sidebar-trending'](trending_data));
		    // $('.trending-widget-list').append('<li><a href="' + data[key]._id + '">' + data[key].value.title + '</a><div class="trending-column-shares">' + total_count + ' Shares</div></li>');
		    $('.trending-widget-list a').dotdotdot();
		}
    },

	load_related_articles: function (tpl){
	    relatedFireOnce = 0;
	    trendingFireOnce = 0;
	    latestFireOnce = 0;

		site_data.related_wrapper(tpl, 'related', function() {
		    site_data.more_related_articles(tpl);
		});

		// site_data.related_wrapper(tpl, 'trending', function() {
		//     site_data.more_trending_articles(tpl);
		// });

		// site_data.related_wrapper(tpl, 'latest', function() {
		//     site_data.more_latest_articles(tpl);
		// });

    	site_nav.smooth_scroll();
    	// site_nav.set_related_active();
	},

	related_wrapper: function(tpl, type, callback) {
		//console.log('START BELOW ARTICLE STUFF');
	    var wrapperData = {
	    	'type': type
	    };

        $('.below').append(tpl['related-wrapper'](wrapperData));

	    if (wrapperData['type'] == 'related'){
		    $(window).scroll(function() {
		        if ($(window).scrollTop() + $(window).height() > $(document).height() - 500 && relatedFireOnce == 0) {
		            callback();
		        }
		    });

	    } else if (wrapperData['type'] == 'trending'){
		    $(window).scroll(function() {
		        if ($(window).scrollTop() + $(window).height() > $(document).height() - 500 && trendingFireOnce == 0) {
		            callback();
		        }
		    });

		} else if (wrapperData['type'] == 'latest'){
		    $(window).scroll(function() {
		        if ($(window).scrollTop() + $(window).height() > $(document).height() - 500 && latestFireOnce == 0) {
		            callback();
		        }
		    });

	    }

	},




	infinite_wrapper: function (tpl, type, callback) {

	    infiniteFireOnce = 0;
	    var pageType = 'grid';
	    var wrapperData = {
	    	'type': type,
	    	'pg': article_inf_page
	    };
		$('.below').append(tpl['infinite-related'](wrapperData));
		if (wrapperData['type'] == 'latestinfinite') {
	    	// console.log(wrapperData['type']);
			$(window).scroll(function(){
				if ($(window).scrollTop() + $(window).height() > $(document).height() - 500 && infiniteFireOnce == 0){
					callback(pageType);
				}
			});

	    }
	},



	more_related_articles: function (tpl) {
	    var pageType = 'grid';
	    relatedFireOnce = 1;
    	var article_id = $('article.main-story').data('pid');
    	// console.log('fire related');

	    $.getJSON('http://elitedaily.com/?elasticsearch=get_related_posts&post_id=' + article_id + '&mlt_fields=title,content', function(data) {
	    	if (data == undefined || data == null){
				$('.related-loader-gif').hide();
	    	}
			var posts = data.posts.sort(function(a,b) {
			  return (+b._id) - (+a._id);
			});
			// posts = posts.reverse();

			if (sl_window_width > 1024){
				var num_of_posts = 5;
			}
			else if (sl_window_width <= 1024 && sl_window_width >= 768){
				var num_of_posts = 5;
			}
			else if (sl_window_width < 768){
				var num_of_posts = 6;
			}

	    	if (posts.length){
		        for (var i = 0; i < num_of_posts; i++) {

		            var theData = {
		                postTitle: posts[i]._source.title,
		                postDate: posts[i]._source.date,
		                postExcerpt: posts[i]._source.excerpt,
		                postCategory: posts[i]._source.categories[0].title,
		                postCategorySlug: posts[i]._source.categories[0].slug,
		                postAuthor: posts[i]._source.author.name,
		                postAuthorSlug: posts[i]._source.author.slug,
		                postAuthorImage: posts[i]._source.author.avatar.img,
		                postImage: posts[i]._source.featured_image['wide-full'].url,
		                postImageSquare: posts[i]._source.featured_image['square-medium'].url,
		                postLink: posts[i]._source.url,
		                postCount: i
		            };

		            if (pageType == 'grid') {

	                	$('.related-loader-gif').hide();

		                if (i == 0) {
		                    $('.related-content-wrapper .two-third-column').append(tpl['two-third-related'](theData));


		                } else if (i == 1 ) {
		                    theData['articleClass'] = 'top-one-third-article';
		                    $('.related-content-wrapper .one-third-column-inner-wrap').append(tpl['one-third-related'](theData));

		                } else if (i == 2 && sl_window_width < 768) { // for mobile
		                    theData['articleClass'] = 'bottom-one-third-article';
		                    $('.related-content-wrapper .one-third-column-inner-wrap').append(tpl['one-third-related'](theData));

		                } else {

		                    $('.related-content-wrapper .three-columns').append(tpl['three-up-related'](theData));
		                }


		            } else {

		                if (i == 0 || i == 1) {
		                    theData['articleClass'] = 'add-bottom-margin';
		                    $('.related-feed').append(tpl['two-third-related'](theData));

		                } else {

		                    $('.related-feed').append(tpl['horizontal-related'](theData));
		                }
		            }

		            site_content.convert_dates('.below time');
		        };

                site_dfp_ads.load_related_ads();
		        // For Lazy Load - currently turned off
		        $('body').trigger('related-load');

		        if (pageType != 'grid') {
		            var sidebarData = '';
		            $('.below .sidebar-inner-wrapper').append(tpl['sidebar-related'](sidebarData));
		        }

		        site_content.default_content_image();
		        //site_content.lazy_load_init();
	    	} else {
	    		$('.related-loader-gif').hide();
	    	}

	    })
		.done(function(){
			if (relatedFireOnce == 1){
				site_data.related_wrapper(tpl, 'trending', function() {
				    site_data.more_trending_articles(tpl);
				});
			}
		})
		.error(function(){
        	$('.related-loader-gif').hide();
			if (relatedFireOnce == 1){
				site_data.related_wrapper(tpl, 'trending', function() {
				    site_data.more_trending_articles(tpl);
				});
			}        	
		});
	},


	more_trending_articles: function (tpl) {
	    trendingFireOnce = 1;
	    // console.log('trending');

	    // for stage
	    // var trending_array = [801839, 804017, 804399, 804473, 804453, 804395, 804416, 803929, 803897];

	    // for local
	    // var trending_array = [742081, 742034, 741855, 741820, 741909, 741797, 741622, 741653, 742067];

	    // TODO: call weekly if undefined
	    if (trending_array == undefined){
	    	$('.trending-content-wrapper .trending-loader-gif').hide();
	    	return;
	    }

    	var posts_string = '';
    	for (var i = 0; i < trending_array.length; i++) {
    		posts_string += '&post__in[]=' + trending_array[i];
    	};

	    $.getJSON('/?json=get_posts&type=posts' + posts_string, function(data) {
	    	site_data.trending_article_grid(data);

	    })
	    .done(function(){
	    	if (trendingFireOnce == 1){
				site_data.related_wrapper(tpl, 'latest', function() {
				    site_data.more_latest_articles(tpl);
				});	    		
	    	}
	    });
	},

	shuffle_array: function (o){
	    for(var j, x, i = o.length; i; j = Math.floor(Math.random() * i), x = o[--i], o[i] = o[j], o[j] = x);
	    return o;
	},

	trending_article_grid: function (data){

    	if (data != null && data.posts.length > 0){

		    var trending_posts = site_data.shuffle_array(data.posts);

	        for (var i = 0; i < 6; i++) {

	            var trendingData = {
	                postTitle: trending_posts[i].title,
	                postDate: trending_posts[i].date,
	                postExcerpt: trending_posts[i].excerpt,
	                postCategory: trending_posts[i].categories[0].title,
	                postCategorySlug: trending_posts[i].categories[0].slug,
	                postAuthor: trending_posts[i].author.name,
	                postAuthorSlug: trending_posts[i].author.slug,
	                postAuthorImage: trending_posts[i].author.avatar.img,
	                postImage: trending_posts[i].featured_image['wide-full'].url,
	                postImageSquare: trending_posts[i].featured_image['square-medium'].url,
	                postLink: trending_posts[i].url,
	                postCount: i
	            };

            	$('.trending-loader-gif').hide();

                if (i == 0) {
                    $('.trending-content-wrapper .two-third-column').append(tpl['two-third-related'](trendingData));

                } else if (i == 1 || i == 2) {
                    trendingData['articleClass'] = ((i == 1) ? 'top-one-third-article' : 'bottom-one-third-article');
                    $('.trending-content-wrapper .one-third-column-inner-wrap').append(tpl['one-third-related'](trendingData));

                } else {
                    $('.trending-content-wrapper .three-columns').append(tpl['three-up-related'](trendingData));
                }


	            site_content.convert_dates('.below time');
	        };

	        $('body').trigger('related-load');

	        site_content.default_content_image();
	        site_content.lazy_load_init();

    	} else {
	    	$('.trending-content-wrapper .trending-loader-gif').hide();
    	}
	},

	more_latest_articles: function (tpl) {

	    var pageType = 'grid';
	    latestFireOnce = 1;

    	// console.log('fire latest');
	    $.getJSON('/?json=get_posts', function(data) {
	    	// console.log(data);
	    	if (data != null){
		        for (var i = 0; i < 6; i++) {

		            var latestData = {
		                postTitle: data.posts[i].title,
		                postDate: data.posts[i].date,
		                postExcerpt: data.posts[i].excerpt,
		                postCategory: data.posts[i].categories[0].title,
		                postCategorySlug: data.posts[i].categories[0].slug,
		                postAuthor: data.posts[i].author.name,
		                postAuthorSlug: data.posts[i].author.slug,
		                postAuthorImage: data.posts[i].author.avatar.img,
		                postImage: data.posts[i].featured_image['wide-full'].url,
		                postImageSquare: data.posts[i].featured_image['square-medium'].url,
		                postLink: data.posts[i].url,
		                postCount: i
		            };

	            	$('.latest-loader-gif').hide();

	                if (i == 0) {
	                    $('.latest-content-wrapper .two-third-column').append(tpl['two-third-related'](latestData));

	                } else if (i == 1 || i == 2) {
	                    latestData['articleClass'] = ((i == 1) ? 'top-one-third-article' : 'bottom-one-third-article');
	                    $('.latest-content-wrapper .one-third-column-inner-wrap').append(tpl['one-third-related'](latestData));

	                } else {
	                    $('.latest-content-wrapper .three-columns').append(tpl['three-up-related'](latestData));
	                }


		            site_content.convert_dates('.below time');
		        };

		        $('body').trigger('related-load');

		        site_content.default_content_image();
		        site_content.lazy_load_init();
	    	}

	    }).done(function(){
			article_inf_page = 2;
			site_data.infinite_wrapper(tpl, 'latestinfinite', function() {
			    site_data.article_infinite_scroll();
			});					
	    	site_nav.set_related_active();
	    });
	},

	article_infinite_scroll: function (){
			// console.log('article inf triggered');
			// console.log(article_inf_page);
			infiniteFireOnce = 1;
			$.getJSON('/?json=get_posts&page=' + article_inf_page, function(data) {
		    	// console.log(data);
		    	if (data != null){
			        for (var i = 0; i < 6; i++) {

			            var latestData = {
			                postTitle: data.posts[i].title,
			                postDate: data.posts[i].date,
			                postExcerpt: data.posts[i].excerpt,
			                postCategory: data.posts[i].categories[0].title,
			                postCategorySlug: data.posts[i].categories[0].slug,
			                postAuthor: data.posts[i].author.name,
			                postAuthorSlug: data.posts[i].author.slug,
			                postAuthorImage: data.posts[i].author.avatar.img,
			                postImage: data.posts[i].featured_image['wide-full'].url,
			                postImageSquare: data.posts[i].featured_image['square-medium'].url,
			                postLink: data.posts[i].url,
			                postCount: i
			            };

		            	$('.latestinfinite-loader-gif').hide();
 
		                if (i == 0) {
		                    $('#latestinfinite-' + article_inf_page + ' .two-third-column').append(tpl['two-third-related'](latestData));

		                } else if (i == 1 || i == 2) {
		                    latestData['articleClass'] = ((i == 1) ? 'top-one-third-article' : 'bottom-one-third-article');
		                    $('#latestinfinite-' + article_inf_page + ' .one-third-column-inner-wrap').append(tpl['one-third-related'](latestData));

		                } else {
		                    $('#latestinfinite-' + article_inf_page + ' .three-columns').append(tpl['three-up-related'](latestData));
		                }


			            site_content.convert_dates('.below time');
			        };
					site_dfp_ads.load_article_infinite_ad(article_inf_page);
			        $('body').trigger('related-load');

			        site_content.default_content_image();
			        site_content.lazy_load_init();
		    	}

		    }).done(function(){
				article_inf_page++;
				site_data.infinite_wrapper(tpl, 'latestinfinite', function() {
				    site_data.article_infinite_scroll();
				    
				});	
		    });	


	},


	get_article_shares: function (){
	    var locationUrl = location.href;
	    var articleUrl = locationUrl.replace(location.host, 'elitedaily.com');
	    $.getJSON('/wp-content/plugins/trending-is/article-proxy.php?link=' + articleUrl, function(data) {
	        if (data != null) {
	            var singleTotal = 0;
	            if (data.facebook && data.facebook.length) singleTotal += parseInt(data.facebook[data.facebook.length - 1].total_count);
	            if (data.twitter && data.twitter.length) singleTotal += parseInt(data.twitter[data.twitter.length - 1].count);
	            if (data.linkedin && data.linkedin.length) singleTotal += parseInt(data.linkedin[data.linkedin.length - 1].count);
	            if (data.pinterest && data.pinterest.length) singleTotal += parseInt(data.pinterest[data.pinterest.length - 1].count);
	            if (singleTotal > 100) {
	            	var totalShares = {};
	            	totalShares['realTotal'] = singleTotal;
	            	totalShares['abbrTotal'] = numeral(singleTotal).format('0,0a');
	                $('.total-share-count span').append(tpl['article-share-number'](totalShares));

	            }
	            var singleTotalConverted = numeral(singleTotal).format('0,0a');
                $('.total-share-count').data('share-count-converted', singleTotalConverted);
                $('.total-share-count').data('share-count', singleTotal);
	        } else {
	            site_data.get_article_shares_fb(articleUrl);
	        }
	    });
	},

	get_article_shares_fb: function (url){
		if (url == undefined){
			url = location.href;
			var articleUrl = url.replace(location.host, 'elitedaily.com');
		}
	    $.getJSON('//api.facebook.com/restserver.php?method=links.getStats&format=json&urls=' + articleUrl, function(data) {
	        if ( data.length > 0) {
	        	// console.log(data);
	            var singleTotal = parseInt(data[0].total_count);
	            if (singleTotal > 100){
	            	var totalShares = {};
	            	totalShares['realTotal'] = singleTotal;
	            	totalShares['abbrTotal'] = numeral(singleTotal).format('0,0a');
	                $('.total-share-count span').append(tpl['article-share-number'](totalShares));            
	            }
	            var singleTotalConverted = numeral(singleTotal).format('0,0a');
                $('.total-share-count').data('share-count-converted', singleTotalConverted);
                $('.total-share-count').data('share-count', singleTotal);
	        }
	    });
	},

	get_sponsored_post: function (pid, clickLink, brandLink){
		$.getJSON('/?elasticsearch=get_post&post_id=' + pid, function(data){
			// if (data.post) {
				var the_post = data.post;
				if (clickLink != undefined){
					the_post['click-thru'] = clickLink;
				} else {
					the_post['click-thru'] = the_post['url'];
				}
				if (strangelove.is_current_page('home')){
					$('.sponsored-horizontal-article').addClass('horizontal-article hz-img-left large-12');
					$('.sponsored-horizontal-article').html(tpl['home-sponsored-article'](the_post));
					$('.sponsored-horizontal-article time').timeago();
				} else {
					//console.log(the_post);
					$('.sponsor-related-card').html(tpl['one-third-sponsor-related'](the_post));
					$('.sponsor-related-card').css({'border':'1px solid #e7e7e7'});
					$('.sponsor-related-card').timeago();
				}
			// }
		}).done(function(data){
			site_data.get_sponsor_brand(data.post.sponsor, clickLink, brandLink);
		});
	},

	get_sponsored_post_adhesion: function (pid, clickLink, brandName, postTitle, postImage, videoUrl){
		if (sl_window_width > 768) return;
		if (postTitle == '' || postTitle == undefined){			
			$.getJSON('/?json=get_post&post_id=' + pid, function(data){
				if (data.post) {
					var the_post = data.post;

					the_post['click-thru'] = (clickLink != undefined) ? clickLink : the_post['url'];
					
					if (brandName != undefined)
						the_post['sponsor-name'] = brandName;
					

					$('.outer-content-wrapper').append(tpl['native-adhesion'](the_post));
					setTimeout(function(){
						$('.mobile-native-adhesion h2').dotdotdot();
						$('.mobile-native-adhesion').addClass('mobile-native-adhesion-show');
					}, 500);
				}
			});
		} else {
			var the_post = {};
			the_post['click-thru'] = clickLink;
			the_post['video-url'] = (videoUrl != undefined) ? videoUrl : '';
			the_post['sponsor-name'] = brandName;
			the_post['title'] = postTitle;
			the_post['featured_image'] = {};
			the_post['featured_image']['wide-full'] = {};
			the_post['featured_image']['wide-full']['url'] = postImage;
			// console.log(the_post);
			$('.outer-content-wrapper').append(tpl['native-adhesion'](the_post));
			setTimeout(function(){
				$('.mobile-native-adhesion h2').dotdotdot();
				$('.mobile-native-adhesion').addClass('mobile-native-adhesion-show');
			}, 500);			
		}
	},

	close_native_adhesion: function (){
		$('.mobile-native-adhesion').removeClass('mobile-native-adhesion-show');
		// $('.mobile-native-adhesion').hide();
	},
	get_sponsor_brand: function (sid, clickLink, brandLink){
		$.getJSON('/?json=get_post&post_type=Promoters&post_id=' + sid, function(data){
			// if (data.post) {

				var the_post = data.post;

				if (brandLink != undefined){
					the_post['click-thru'] = brandLink;
				} else {
					the_post['click-thru'] = the_post['url'];
				}

				if (the_post.featured_image['square-medium'].url) {
					the_post['sponsored_logo'] = the_post.featured_image['square-medium'].url;
				}

				if (strangelove.is_current_page('home')){
					$('.sponsored-horizontal-article .sub-text').prepend(tpl['home-sponsored-photo'](the_post));

				} else {
					$('.sponsor-related-card .sub-text').prepend(tpl['home-sponsored-photo'](the_post));

				}

				// second click link?
				// the_post['click-thru'] = clickLink;

			// }
		});
	},

	ajax_bookmark: function(){
		//console.log('test');
		$(document).on('click tap', 'a.bookmark-link', function(e){
			e.preventDefault();
			var type = $(this).hasClass('fav') ? 'fav' : 'unfav';
			var this_url = $(this).attr('href');
			var this_pid = $(this).data('pid');
			var this_activity_id = $(this).data('activityid');
			var data = {
				action: 'activity_mark_' + type,
				'id': this_activity_id
			};
			var $this = $(this);

			// since 2.8 ajaxurl is always defined in the admin header and points to admin-ajax.php
			$.post(ajaxurl, data, function(response) {
				//change DOM element
				// alert(response);
				if (type == 'fav'){
					$this.removeClass('fav icon-ed-bookmark');
					$this.addClass('unfav icon-ed-bookmark-fill');
					((strangelove.is_current_page('home')) ? $this.html('Saved') : $this.html(' '));
				} else {
					$this.removeClass('unfav icon-ed-bookmark-fill');
					$this.addClass('fav icon-ed-bookmark');
					((strangelove.is_current_page('home')) ? $this.html('Read Later') : $this.html(' '));
				}
			});

		});
	},

	sl_topic_follow: function (){
		var topicid = $('.topic-follow-button').data('topicid');
		$(document).on('click tap', '.topic-follow-button.logged-in', function(e){
			e.preventDefault();
			var data = {
				'action': 'bp_topic_start_following',
				'post_id': topicid,
				'follow_type':'post_topic',

			};
			var $this = $(this);
			var type = $(this).hasClass('following') ? 'following' : 'follow';
			// since 2.8 ajaxurl is always defined in the admin header and points to admin-ajax.php
			$.post(ajaxurl, data, function(response) {
				if (type == 'follow'){
					$this.removeClass('follow');
					$this.addClass('following');
					$this.html('Following');
				} else {
					$this.removeClass('following');
					$this.addClass('follow');
					$this.html('Follow');
				}
			});


		});

	},
	sl_topic_follow_home: function (){
		for (var i = 1; i < $('.topic-article-large').length + 1; i++) {
			var temp_topic_id = $('#topic-article-large-'+i).data('topicid');
			$('#topic-follow-button-'+i).data('topicid', temp_topic_id);
		};

		$(document).on('click tap', '.topic-follow-button.logged-in', function(e){
			e.preventDefault();
			var topicid = $(this).data('topicid');
			var data = {
				'action': 'bp_topic_start_following',
				'post_id': topicid,
				'follow_type':'post_topic',

			};
			var $this = $(this);
			var type = $(this).hasClass('following') ? 'following' : 'follow';
			// since 2.8 ajaxurl is always defined in the admin header and points to admin-ajax.php
			$.post(ajaxurl, data, function(response) {
				if (type == 'follow'){
					$this.removeClass('follow');
					$this.addClass('following');
					$this.html('Following');
				} else {
					$this.removeClass('following');
					$this.addClass('follow');
					$this.html('Follow');
				}
			});


		});

	},
	sl_topic_follow_sidebar: function (){

		$(document).on('click tap', '.follow-topic-sidebar.logged-in', function(e){
			e.preventDefault();
			var topicid = $(this).data('topicid');
			var data = {
				'action': 'bp_topic_start_following',
				'post_id': topicid,
				'follow_type':'post_topic',

			};
			var $this = $(this);
			var type = $(this).hasClass('following') ? 'following' : 'follow';
			// since 2.8 ajaxurl is always defined in the admin header and points to admin-ajax.php
			$.post(ajaxurl, data, function(response) {

				if (type == 'follow'){
					$this.removeClass('follow');
					$this.addClass('following');
					$this.html('Following');
				} else {
					$this.removeClass('following');
					$this.addClass('follow');
					$this.html('Follow This Storyline');
				}
			});


		});

	},
	user_pagination: function (){
		$(document).on('click tap', '#load-more-btn', function(e){
			e.preventDefault();
			var author_pageid = ($('.activity-list').data('pageid') == undefined ? 1 : $('.activity-list').data('pageid'));
			author_pageid++;
			$(this).hide();
			var data = {
				'action': 'activity_get_older_updates',
				'cookie': bp_get_cookies(),
				'page': author_pageid // We pass php values differently!
			};
			// We can also pass the url value separately from ajaxurl for front end AJAX implementations
			jQuery.post(ajaxurl, data, function(response) {
				var obj = JSON.parse(response);
				$(".activity-list").append(obj.contents);
				$('.activity-list').data('pageid', author_pageid);
				site_content.convert_dates();
			});
		});
	},
    loadYt: function (theId) {
    	if (theId == '') return;
		vidId = site_data.getParameterByName('v', theId);
		var ytPlayer = document.createElement('div');
		ytPlayer.id = 'player';
		div_below = document.getElementById('after-content');
		div_below.insertBefore(ytPlayer, div_below.childNodes[0]);
		site_data.setYouTubeAsync();
    },	
	getParameterByName: function (name, url) {
		name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
		var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
			results = regex.exec(url);
		return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
    },
    setYouTubeAsync: function (){
		var tag = document.createElement('script');
		tag.src = "https://www.youtube.com/iframe_api";
		var firstScriptTag = document.getElementsByTagName('script')[0];
		firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
    }    
}

// EVENT LISTENER TO RECEIVE CALLS FROM RTB REFRESH
var ad_ref = 0;
var repeatAdTriggered = 0;
var site_ads = {
    asyncDesktopSafe: function(ad_id){
    	if ($(window).width() > 1024) {
            if (ad_ref == 1) {
                ADTECH.loadAd(ad_id);

            } else {
                this.setReferrer(function(){
                    ad_ref = 1;
        	        ADTECH.loadAd(ad_id);
                });
            }
    	}
    },
    asyncDesktopEnqueue: function (ad_id){
    	if ($(window).width() > 1024) {
            if (ad_ref == 1) {
                ADTECH.enqueueAd(ad_id);

            } else {
                this.setReferrer(function(){
                    ad_ref = 1;
                    ADTECH.enqueueAd(ad_id);
                });
            }
    	}
    },
    asyncLoadEnqueued: function (){
    	ADTECH.executeQueue();
    },
    asyncTabletSafe: function (ad_id){
    	if ($(window).width() <= 1024 && $(window).width() >= 768) {
            if (ad_ref == 1) {
                ADTECH.loadAd(ad_id);

            } else {
                this.setReferrer(function(){
                    ad_ref = 1;
                    ADTECH.loadAd(ad_id);
                });
            }
    	}
    },
    asyncMobileSafe: function (ad_id){
    	if ($(window).width() < 768) {
            ADTECH.config.page.server = 'a.adtechus.com';
            if (ad_ref == 1) {
                ADTECH.loadAd(ad_id);

            } else {
                this.setReferrer(function(){
                    ad_ref = 1;
                    ADTECH.loadAd(ad_id);
                });
            }
    	}
    },
    setReferrer: function(callback){
        var referrer = parseUri(document.referrer);
        // console.log(referrer);
        // console.log('^^^');
        if (referrer.host == undefined || referrer.host === ""){
            ADTECH.config.page.kv.referrer = 'none';
            // ADTECH.config.page.kv.amznslots = amznads.getTokens();
            
        } else {
            ADTECH.config.page.kv.referrer = referrer.host;
            // ADTECH.config.page.kv.amznslots = amznads.getTokens();

        }
        callback();
    },
    longform_ads: function(){
        if ($('.longform p').length > 12){
            $('.longform p').eq(0).after('<div class="long-form-ad-rectangle"></div>')
            $('.longform p').eq(10).after('<div class="long-form-ad-rectangle-long"></div>')
        }

    },
    load_related_ads: function (){

        // Show Desktop Ad
        if (sl_window_width > 1024){

            // Show Native Ad or Triple Lift Unit
            var lazy_sponsor_id = $('.below').data('adid');
            var lazy_sponsor_id = parseInt(lazy_sponsor_id);
            $('.related-content-wrapper .one-third-column-inner-wrap').append('<div id="'+ lazy_sponsor_id +'" class="bottom-one-third-article related-card sponsor-related-card" data-adid="'+ lazy_sponsor_id +'"></div>');
            ADTECH.config.placements[lazy_sponsor_id] = { sizeid: 16, params: { alias: '', target: '_blank', allowedSizes: '300x250,350x270'}};
            site_ads.asyncDesktopSafe(lazy_sponsor_id);
            //console.log(lazy_sponsor_id);

            // 728x90 Leaderboard Ad Unit
            var leaderboard_ad_data = {
                leaderboard_id: $('.below').data('leaderboardadid')
            };

            $('.related-content-wrapper').append(tpl['related-leaderboard-ad'](leaderboard_ad_data));
            ADTECH.config.placements[leaderboard_ad_data.leaderboard_id] = { sizeid: 225, fif: {usefif: 'true'}, params: { alias: '', target: '_blank' }};
            site_ads.asyncDesktopSafe(leaderboard_ad_data.leaderboard_id);

        }

        // Show Tablet Ad (Sponsored Post)
        if (sl_window_width <= 1024 && sl_window_width >= 768){
            var tablet_btf_id = $('.below').data('tabletadid');
            //console.log('tablet ' + tablet_btf_id);
            var tablet_btf_id = parseInt(tablet_btf_id);
            $('.related-content-wrapper .one-third-column-inner-wrap').append('<div id="' + tablet_btf_id + '" class="bottom-one-third-article related-card sponsor-related-card" data-adid="' + tablet_btf_id + '"></div>');
            ADTECH.config.placements[tablet_btf_id] = { sizeid: 16, params: { alias: '', target: '_blank', allowedSizes: '300x250,350x270'}};
            site_ads.asyncTabletSafe(tablet_btf_id);
        }

        // Show Mobile BTF B Ad (300x250 Ad at bottom of related)
        if (sl_window_width < 768){
            var mobile_btf_string = $('.below').data('mobileadid');
            if (mobile_btf_string != ''){
                var mobile_btf_json = mobile_btf_string.replace(/\'/g, '\"');
                var mobile_btf_obj = JSON.parse(mobile_btf_json);
                mobile_btf_obj.id = parseInt(mobile_btf_obj.id);
                mobile_btf_obj.size_id = parseInt(mobile_btf_obj.size_id);
                $('.related-content-wrapper .content-area').append('<div class="columns"><div id="' + mobile_btf_obj.id + '" class="ad-mobile-rectangle-wrapper sponsor-related-card related-card" data-adid="' + mobile_btf_obj.id + '"></div></div>');
                ADTECH.config.placements[mobile_btf_obj.id] = { sizeid: mobile_btf_obj.size_id, params: { alias: mobile_btf_obj.alias, target: '_blank' }};
                site_ads.asyncMobileSafe(mobile_btf_obj.id);
            }
        }


    },
    load_article_infinite_ad: function (pg){
        var leaderboard_ad_data = {
            leaderboard_id: $('.below').data('leaderboardadid')
        };
        if ($('#related #'+leaderboard_ad_data.leaderboard_id).length == 1){
            $('#related #'+leaderboard_ad_data.leaderboard_id).attr('id', leaderboard_ad_data.leaderboard_id + '-1');
        }

        $('#latestinfinite-' + pg).append(tpl['related-leaderboard-ad'](leaderboard_ad_data));
        site_ads.asyncDesktopSafe(leaderboard_ad_data.leaderboard_id);
        $('#latestinfinite-' + pg + ' #' + leaderboard_ad_data.leaderboard_id).attr('id', leaderboard_ad_data.leaderboard_id + '-' + pg);
    },
    receive_refresh: function (event){
        // if (event.origin == 'http://elitedaily.com' && event.data != undefined){
        //     if (event.data.indexOf("refresh") > -1){
        //         var msg = event.data;
        //         var refresh_parts = msg.split('-');
        //         var refresh_id = refresh_parts[1];
        //         var refresh_id = parseInt(refresh_id);
        //         ADTECH.loadAd(refresh_id);
        //     }
        // }
        // return;
    },
    repeating_feed_ad_init: function (){
        // var firstAdBreak = $('.ad-break').eq(0).offset().top;
        // var windowHeight = $(window).height();
        // var adBuffer = 500;
        // $(window).scroll(function(){
        //     if ($(window).scrollTop() > firstAdBreak - windowHeight - adBuffer && repeatAdTriggered == 0){
        //         //console.log('triggerme');
        //         site_ads.repeating_feed_ad();
        //     }
        // });
    },
    repeating_feed_ad: function (pgNum){
        // repeatAdTriggered = 1;
        // //console.log('callmade');
        // if (sl_window_width > 1024){
        //     if ($('.repeating-leaderboard-ad').length > 0 && $('.ad-break').is(':visible')) {
        //         var indexNo = (pgNum == undefined) ? 0 : pgNum;
        //         var indexId = indexNo + 1;
        //         var repeating_adid = $('.repeating-leaderboard-ad').eq(indexNo).data('adid');
        //         ADTECH.config.placements[repeating_adid] = { sizeid: 225, fif: {usefif: 'true'}, params: { alias: '', target: '_blank' }};
        //         site_ads.asyncDesktopSafe(repeating_adid);
        //         $('#'+repeating_adid).attr('id', repeating_adid + '-' + indexId);
        //     }
        // }
        // else if (sl_window_width <= 1024 && sl_window_width >= 768){
        //     if ($('.repeating-tablet-leaderboard-ad').length > 0 && $('.ad-break').is(':visible')) {
        //         var indexNo = (pgNum == undefined) ? 0 : pgNum;
        //         var indexId = indexNo + 1;
        //         var repeating_adid = $('.repeating-tablet-leaderboard-ad').eq(indexNo).data('adid');
        //         ADTECH.config.placements[repeating_adid] = { sizeid: 225, fif: {usefif: 'true'}, params: { alias: '', target: '_blank' }};
        //         site_ads.asyncTabletSafe(repeating_adid);
        //         $('#'+repeating_adid).attr('id', repeating_adid + '-' + indexId);
        //     }
        // }
    },
    taboola_ads: function (){

        body_script = '<script type="text/javascript">' +
                          'window._taboola = window._taboola || [];' +
                          '_taboola.push({flush: true});' +
                        '</script>';

        header_script = '<script type="text/javascript">' +
                          'window._taboola = window._taboola || [];' +
                          '_taboola.push({article:\'auto\'});' +
                          '!function (e, f, u) {' +
                            'e.async = 1;' +
                            'e.src = u;' +
                            'f.parentNode.insertBefore(e, f);' +
                          '}(document.createElement(\'script\'),' +
                          'document.getElementsByTagName(\'script\')[0],' +
                          '\'http://cdn.taboola.com/libtrc/elitedaily/loader.js\');' +
                        '</script>';

        article_script = '<script type="text/javascript">' +
                          'window._taboola = window._taboola || [];' +
                          '_taboola.push({' +
                            'mode: \'thumbnails-a\',' +
                            'container: \'taboola-below-article-thumbnails\',' +
                            'placement: \'Below Article Thumbnails\',' +
                            'target_type: \'mix\'' +
                          '});' +
                        '</script>';

        $('head').append(header_script);
        $('body').append(body_script);
        $('#taboola-below-article-thumbnails').append(article_script);

    }
};
var article_repeating_count = 1;
var site_dfp_ads = {
	desktop_safe: function (the_ad, lazyad){
		if ($(window).width() > 1024) {
			// console.log('desktop: ' + the_ad);
			googletag.cmd.push(function() {
				if (lazyad != undefined){
					googletag.defineSlot('/5765/elitedaily.us/ed_ed'+ ad_kvs.area +'_' + ad_kvs.area + 'art/mpu_promo', [[300, 250], [350, 270]], the_ad).addService(googletag.pubads()).setTargeting("pos", ["mpu_promo"]);
				}
				googletag.display(the_ad);
			});
		}
	},
	tablet_safe: function (the_ad){
		if ($(window).width() <= 1024 && $(window).width() >= 768) {
			// console.log('tablet: ' + the_ad);
			googletag.cmd.push(function() {
				googletag.display(the_ad);
			});
		}
	},
	mobile_safe: function (the_ad, lazyad){
		if ($(window).width() < 768) {
			// console.log('mobile: ' + the_ad);			
			googletag.cmd.push(function() {
				if (lazyad != undefined){
					googletag.defineSlot('/5765/elitedaily.mob/ed_ed'+ ad_kvs.area +'_mob'+ ad_kvs.area + 'art/mpu_bot', [300, 250], 'dfp_rectangle_bottom').addService(googletag.pubads()).setTargeting("pos", ["mpu_bot"]);
				}				
				googletag.display(the_ad);
			});
		}
	},
	repeating_feed_ad: function (pg_count){
		if ($('body').hasClass('video') && $('body').hasClass('page')) return;
		
		var slotName = 'dfp_repeating_leaderboard-' + pg_count;
		googletag.cmd.push(function() {
			var slot = googletag.defineSlot('/5765/elitedaily.us/ed_edhome_homehp/leaderboard', [728, 90], slotName).addService(googletag.pubads()).setTargeting("pos", ["leaderboard"]);
			googletag.display(slotName);
			site_dfp_ads.dfp_key_values();
			googletag.pubads().refresh([slot]);	
			// console.log(slotName);			
		});
	},
	repeating_ad_article: function (pg_count){
		var slotName = 'dfp_repeating_leaderboard-' + pg_count;
		googletag.cmd.push(function() {
			var slot = googletag.defineSlot('/5765/elitedaily.us/ed_ed'+ ad_kvs.area +'_' + ad_kvs.area + 'art/leaderboard', [728, 90], slotName).addService(googletag.pubads()).setTargeting("pos", ["leaderboard"]);
			googletag.display(slotName);
			site_dfp_ads.dfp_key_values();
			googletag.pubads().refresh([slot]);	
			// console.log(slotName);			
		});
	},	
	dfp_key_values: function (){
		for (var key in ad_kvs){
			//console.log(key + ', ' + ad_kvs[key]);
			googletag.pubads().setTargeting(key, ad_kvs[key]);
		}
	},
	mpu_promo_unit: function (){
        // Show Native Ad or Triple Lift Unit
        var lazy_sponsor_id = 'dfp_mpu_promo_unit';
        $('.related-content-wrapper .one-third-column-inner-wrap').append('<div id="'+ lazy_sponsor_id +'" class="bottom-one-third-article related-card sponsor-related-card" data-adid="'+ lazy_sponsor_id +'"></div>');			
        site_dfp_ads.desktop_safe(lazy_sponsor_id, 'lazy');

	},
	mobile_rectangle_bottom: function (){
		var lazy_mobile_bottom_id = 'dfp_rectangle_bottom';
        $('.related-content-wrapper .content-area').append('<div class="columns"><div id="' + lazy_mobile_bottom_id + '" class="ad-mobile-rectangle-wrapper sponsor-related-card related-card" data-adid="' + lazy_mobile_bottom_id + '"></div></div>');
        site_dfp_ads.mobile_safe(lazy_mobile_bottom_id, 'lazy');

	},
	repeating_ad_article_setup: function(){
        // 728x90 Leaderboard Ad Unit
        var repeating_leaderboard_id = 'dfp_repeating_leaderboard-' + article_repeating_count;
        var leaderboard_ad_data = {
            leaderboard_id: repeating_leaderboard_id
        };

        $('.related-content-wrapper').append(tpl['related-leaderboard-ad'](leaderboard_ad_data));
        site_dfp_ads.repeating_ad_article(article_repeating_count);
        article_repeating_count++;

	},
    load_article_infinite_ad: function (pg){
        var repeating_leaderboard_id = 'dfp_repeating_leaderboard-' + article_repeating_count;
        var leaderboard_ad_data = {
            leaderboard_id: repeating_leaderboard_id
        };

        $('#latestinfinite-' + pg).append(tpl['related-leaderboard-ad'](leaderboard_ad_data));
        site_dfp_ads.repeating_ad_article(article_repeating_count);
        article_repeating_count++; 
               
    },	

    load_related_ads: function (){

        // Show Desktop Ad
        if (sl_window_width > 1024){

        	site_dfp_ads.mpu_promo_unit();
        	site_dfp_ads.repeating_ad_article_setup();
        }

        // Show Tablet Ad (Sponsored Post)
        if (sl_window_width <= 1024 && sl_window_width >= 768){
            // var tablet_btf_id = $('.below').data('tabletadid');
            // //console.log('tablet ' + tablet_btf_id);
            // var tablet_btf_id = parseInt(tablet_btf_id);
            // $('.related-content-wrapper .one-third-column-inner-wrap').append('<div id="' + tablet_btf_id + '" class="bottom-one-third-article related-card sponsor-related-card" data-adid="' + tablet_btf_id + '"></div>');
            // ADTECH.config.placements[tablet_btf_id] = { sizeid: 16, params: { alias: '', target: '_blank', allowedSizes: '300x250,350x270'}};
            // site_ads.asyncTabletSafe(tablet_btf_id);
        }

        // Show Mobile BTF B Ad (300x250 Ad at bottom of related)
        if (sl_window_width < 768){
        	site_dfp_ads.mobile_rectangle_bottom();
        }


    },

    set_referrer: function (){
		var referrer = parseUri(document.referrer);
        if (referrer.host != undefined || referrer.host != ''){
            googletag.pubads().setTargeting('targeting', referrer.host);
        }
    },

    load_native_intext_ad: function(pid, clickLink, brandName, postTitle, postImage, adPosition){
		var the_post = {};
		the_post['click-thru'] = clickLink;
		the_post['sponsor-name'] = brandName;
		the_post['title'] = postTitle;
		the_post['featured_image'] = {};
		the_post['featured_image']['wide-full'] = {};
		the_post['featured_image']['wide-full']['url'] = postImage;
		the_post['post-class'] = ' in-text-ad row';
		var paragraph_count = $('.entry-content p').length;
		var paragraph_placement = (adPosition != '' && typeof adPosition != 'undefined') ? parseInt(adPosition) : Math.ceil(paragraph_count / 2);
		paragraph_placement = (paragraph_placement > paragraph_count) ? Math.ceil(paragraph_count / 2) : paragraph_placement;
		$('.entry-content p').eq(paragraph_placement).after(tpl['native-adhesion'](the_post));
		$('.in-text-ad h2').dotdotdot();			
    }
};


// Control JS on Site
var strangelove = {
	setup: function (){
		sl_window_width = this.get_window_width();
		sl_window_height = this.get_window_height();
		article_inf_page = 1;
		// sl_home_page = is_current_page('home');
		// sl_single_page = is_current_page('single');
		// sl_archive_page = is_current_page('archive');
		// sl_category_page = is_current_page('category');
		// sl_activity_page = is_current_page('activity');
		// sl_video_page = is_current_page('video');
		// sl_regular_page = is_current_page('page');
		// sl_error_page = is_current_page('error404');
		// sl_about_page = is_current_page('about');
		// sl_write_for_us_page = is_current_page('write-for-us');
		// sl_topic_page = is_current_page('tax-post_topic');
		this.page_init();
	},

	get_window_width: function (){
		var window_width = $(window).width();
		return window_width;
	},

	get_window_height: function (){
		var window_height = $(window).height();
		return window_height;
	},

	is_current_page: function(page){
		if ($('body').hasClass(page)){
			return true;
		} else {
			return false;
		}
	},

	load_handlebar_templates: function (callback){
	    tpl = {};
	    var template_names = ['two-third-related', 'one-third-related', 'three-up-related', 'horizontal-related', 'feed-related', 'related-wrapper', 'infinite-related', 'sidebar-related', 'sidebar-trending', 'article-share-number', 'home-sponsored-article', 'home-sponsored-photo', 'one-third-sponsor-related', 'related-leaderboard-ad', 'native-adhesion'];
	    if (this.is_current_page('tax-post_topic') && this.is_current_page('term-rock-the-vote')) template_names.push('rock-the-vote');
	    var finished_count = 0;
	    var loader = function(templates, i) {
	        $.get('/wp-content/themes/strangelove/templates/' + templates[i] + '.hbs', function(src) {
	            tpl[templates[i]] = Handlebars.compile(src);
	            finished_count++;
	            if (finished_count == template_names.length) {
	            	//console.log(tpl);
	            	callback(tpl);
	            }
	        });
	    };


	    (function(templates) {
	        for (var i = 0; i < templates.length; i++) {
	            loader(templates, i);
	        }
	    }(template_names));
	},

	touchstart_as_active: function (){
		document.addEventListener("touchstart", function(){}, true);
	},

	page_init: function(){
		// TODO: create leave window modal call to action
		// site_nav.leave_window();
		site_content.lazy_load_init();
		site_nav.mobile_subnav();
		site_nav.mobile_menu();
		site_nav.section_dropdown();
		site_nav.nav_search();
		site_nav.info_modal(site_nav.show_info);
		site_nav.login_modal('.sign-in-header', site_nav.show_login);
		site_sidebar.follow_text_hover();
		site_sidebar.remove_bookmark_hover();
		this.touchstart_as_active();
		site_nav.user_profile_dropdown();



		if (this.is_current_page('home')) {
			// Home Page Functions
			site_data.infinite_scroll();
			site_ads.repeating_feed_ad_init();
			this.load_handlebar_templates(function(){
				// site_data.get_trending_widget(tpl);
			} );
			site_content.default_author_image();
			site_content.convert_dates();
			site_content.show_bookmark();
			site_data.ajax_bookmark();
			site_nav.nav_shadow();
			site_nav.login_modal('.bookmark-button-sign-in', site_nav.show_login);
			site_nav.login_modal('.not-logged-in', site_nav.show_login);
			site_data.sl_topic_follow_home();
			site_data.sl_topic_follow_sidebar();
			site_sidebar.limit_featured_posts(); // For Featured Posts
			site_sidebar.stick_trending_widget(); // For Featured Posts

		} else if (this.is_current_page('single') && this.is_current_page('single-jobs')) {
			// Single Jobs
			site_nav.fixed_header();
			site_nav.nav_shadow();
			// site_nav.email_modal(site_nav.show_email);
			site_content.init_photo_zoom();
			site_content.show_more_share_buttons();
			site_content.set_topic_bg('.topic-cover-image');

		} else if (this.is_current_page('single') && this.is_current_page('single-promoters')) {
			site_nav.nav_shadow('padder');
			// site_nav.email_modal(site_nav.show_email);
			site_sidebar.author_activity();
			site_content.set_topic_bg('.topic-cover-image');
			site_content.show_more_share_buttons();

		} else if (this.is_current_page('nda-custom')) {
			site_nav.nav_shadow();

		} else if (this.is_current_page('single')) {
			// Article Page Functions
			this.load_handlebar_templates(function(){
				// site_data.get_trending_widget(tpl, false);
				site_data.load_related_articles(tpl);
				if ($('body').hasClass('dear-walt-disney-happy-birthday')){
					site_data.get_sponsored_post_adhesion(873098, 'https://www.youtube.com/watch?v=suxKKn-DJeE', 'Tesla', 'Chris Pratt Shares Heartwarming Story Of Son Who Was Born Prematurely', 'http://cdn29.elitedaily.com/wp-content/uploads/2014/12/chrisspratt-600x300.jpg');
				}
			} );
			if ($(window).width() > 768){
				site_nav.fixed_header();
				site_nav.article_header();
				site_data.ajax_bookmark();
				site_content.magnific_popup();
			}
			site_ads.taboola_ads();
			site_nav.nav_shadow('main-story h1');
			// site_nav.email_modal(site_nav.show_email);
			// site_nav.newsletter_modal('.billboard-wrapper', site_nav.show_newsletter);
			site_sidebar.sidebar_scroll();
			site_sidebar.limit_featured_posts(); // For Featured Posts
			site_nav.login_modal('.not-logged-in', site_nav.show_login);
			// site_content.sponsored_truncate();
			site_content.wrap_image_share_btn();
			site_content.show_comment_button();
			site_content.fit_video();
			// site_content.fit_instagram();
			site_content.init_photo_zoom();
			site_content.show_more_share_buttons();
			site_content.show_sources();
			site_content.show_comments();
			site_content.default_author_image();
			site_content.show_more_author_info();
			// site_data.get_article_shares();
			site_data.get_article_shares_fb();
			site_data.sl_topic_follow_sidebar();
			site_content.contributor_email_submit();
			// if (this.is_current_page('longform')){
				//site_ads.longform_ads();
				//site_content.longform_fitvids();
				//site_content.heading_widows();
			// }

		} else if (this.is_current_page('newsletter')) {
			// Newsletter Page
			site_content.flexslider();

		} else if (this.is_current_page('tax-post_topic')) {
			// Taxonomy Page
			site_nav.nav_shadow();
			// site_nav.email_modal(site_nav.show_email);
			this.load_handlebar_templates(function(){
				site_data.get_trending_widget(tpl);
				site_content.set_topic_bg('.topic-cover-image');
			}); // Use if feed layout not grid
			site_data.infinite_scroll();
			site_content.show_bookmark();
			site_content.show_more_share_buttons();
			site_content.convert_dates();

			site_content.default_author_image();
			site_sidebar.follow_text_hover_no_a();
			site_sidebar.author_activity();
			site_nav.login_modal('.not-logged-in', site_nav.show_login);
			site_data.sl_topic_follow();
			site_data.ajax_bookmark();

		} else if (this.is_current_page('archive') && this.is_current_page('category')) {
			// Category / Archive Page Functions
			this.load_handlebar_templates(function(){
				// site_data.get_trending_widget(tpl);
			}); // Use if feed layout not grid
			site_sidebar.limit_featured_posts(); // For Featured Posts
			site_sidebar.stick_trending_widget(); // For Featured Posts
			site_nav.nav_shadow();
			site_content.show_bookmark();
			site_content.convert_dates();
			site_content.set_topic_bg('.category-cover-image');
			site_content.default_author_image();
			site_data.infinite_scroll();
			site_data.ajax_bookmark();
			site_ads.repeating_feed_ad_init();

		} else if (this.is_current_page('archive') && this.is_current_page('tag')) {
			// Category / Archive Page Functions
			this.load_handlebar_templates(function(){
				// site_data.get_trending_widget(tpl);
			}); // Use if feed layout not grid
			site_sidebar.limit_featured_posts(); // For Featured Posts
			site_sidebar.stick_trending_widget(); // For Featured Posts
			site_nav.nav_shadow();
			site_data.infinite_scroll();
			site_content.convert_dates();
			// site_content.set_topic_bg('.category-cover-image');
			site_content.default_author_image();

		} else if (this.is_current_page('video')) {

			site_content.video_page_popup();
			site_content.video_page_get_youtube();
			site_content.video_page_resize();

		} else if (this.is_current_page('videos')) {

			site_content.video_page_popup();
			site_content.video_page_get_youtube();
			site_content.video_page_resize();

		} else if (this.is_current_page('activity') || this.is_current_page('members') || this.is_current_page('your-profile') || this.is_current_page('users') || this.is_current_page('author') ) {
			// Activity Page Functions
			site_nav.nav_shadow('padder');
			site_sidebar.author_activity();
			site_sidebar.fix_author_sidebar();
			site_sidebar.remove_blank_paragraphs();
			site_content.mobile_read_more_author_description();
			site_content.default_author_image();
			site_content.convert_dates();
			site_data.user_pagination();

		} else if (this.is_current_page('brand')) {
			// Activity Page Functions
			site_nav.nav_shadow('padder');
			site_sidebar.author_activity();
			site_sidebar.remove_blank_paragraphs();
			site_content.set_topic_bg('.topic-cover-image');

		} else if (this.is_current_page('about') || this.is_current_page('advertise')) {
			// About / Aux Page Functions
			site_content.equalize_heights();
			site_content.set_topic_bg('.topic-cover-image');
			site_sidebar.remove_blank_paragraphs();

		} else if (this.is_current_page('topics')) {
			// Topics page
			site_nav.nav_shadow();
			site_nav.login_modal('.not-logged-in', site_nav.show_login);
			site_content.equalize_heights();
			site_content.convert_dates();
			// site_content.set_topic_bg('.topic-cover-image');
			site_sidebar.follow_text_hover_no_a();
			site_data.sl_topic_follow();

		} else if (this.is_current_page('faq')) {
			// FAQ Page
			site_content.set_topic_bg('.topic-cover-image');
			site_content.toggle_accordion();

		} else if (this.is_current_page('page') || this.is_current_page('error404')) {
			// Regular Page Functions
			site_nav.nav_shadow();
			site_nav.login_page();
			site_content.set_topic_bg('.topic-cover-image');

		}

	}

}

strangelove.setup();

$(window).resize(function(){
	sl_window_width = strangelove.get_window_width();
});